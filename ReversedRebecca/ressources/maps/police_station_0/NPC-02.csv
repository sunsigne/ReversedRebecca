TIME -> 0 = GOTO -> NAME:MIAOUSS, TEXTURE_NAME:POLICEMAN, PLAYER_AVOIDER_TYPE:FORCE, WAITFOR_STUN:FALSE, SIT, CREATE_CHAIR


//// STATE ////

$ -> CREATE_CHAIR = CREATE_DECORATION -> 9-43-BACK:WORLD,1,2,CHAIR,3-11,1-2
$ -> SIT = GOTO -> WAITFOR_NULL, FACING:RIGHT, CONDITION:SIT, DISPLAY_SIT
$ -> WAITFOR_NULL = WAITFOR -> NULL
$ -> DISPLAY_NORMAL = DISPLAY -> 0, 0
$ -> DISPLAY_SIT = DISPLAY -> -1, -3
! -> FACING_UP = FACING -> UP
! -> FACING_DOWN = FACING -> DOWN
! -> FACING_RIGHT = FACING -> RIGHT
! -> EXPRESSION_SUSPENSION = EXPRESSION -> SUSPENSION


//// INTRUSION ////

WONPUZZLE -> 13-44 = MEMORY -> SECOND_INTRUSION_IN_MIAOUSS_DESK ? SECOND_INTRUSION / FIRST_INTRUSION
$ -> FIRST_INTRUSION = GOTO -> EXPRESSION:EXCLAMATION, WAITFOR_LEAVING_CHAIR
$ -> WAITFOR_LEAVING_CHAIR = WAITFOR -> TIMER:1 ? LEAVE_CHAIR_CONDITIONNAL_PRE
$ -> LEAVE_CHAIR_CONDITIONNAL_PRE = CONDITION -> GOOD ? LEAVE_CHAIR_CONDITIONNAL / TP:9-43, CREATE_COMPUTER_HANDLER, DISPLAY_NORMAL, CONDITION:GOOD, LEAVE_CHAIR_CONDITIONNAL
$ -> LEAVE_CHAIR_CONDITIONNAL = SEE -> PLAYER ? PLAYER_SPOTTED / SLOW:13-44, WAITFOR_REACH_DOOR
$ -> WAITFOR_REACH_DOOR = WAITFOR -> PLAYER_CLOSER_THAN:5 ? PLAYER_SEEN_WHILE_GOING_DOOR_SECOND_VERIFICATION
$ -> PLAYER_SEEN_WHILE_GOING_DOOR_SECOND_VERIFICATION = SEE -> PLAYER ? PLAYER_SPOTTED / WAITFOR_REACH_DOOR
GOAL -> 13-44 = SEE -> PLAYER ? PLAYER_SPOTTED / SLOW:14-44
GOAL -> 14-44 = SEE -> PLAYER ? PLAYER_SPOTTED / WAITFOR_BEFORE_SUSPENSION_IN_FRONT_OF_DESK
$ -> WAITFOR_BEFORE_SUSPENSION_IN_FRONT_OF_DESK = WAITFOR -> TIMER:1 ? WAITFOR_HEADING_CORRIDOR_CONDITIONNAL
$ -> WAITFOR_HEADING_CORRIDOR_CONDITIONNAL = SEE -> PLAYER ? PLAYER_SPOTTED / EXPRESSION:SUSPENSION, WAITFOR_HEADING_CORRIDOR
$ -> WAITFOR_HEADING_CORRIDOR = WAITFOR -> TIMER:1 ? CHECK_FOR_PLAYER_BEFORE_HEADING_CORRIDOR
$ -> CHECK_FOR_PLAYER_BEFORE_HEADING_CORRIDOR = SEE -> PLAYER ? PLAYER_SPOTTED / WAITFOR_HEADING_CORRIDOR_NEXT
$ -> WAITFOR_HEADING_CORRIDOR_NEXT = WAITFOR -> TIMER:1 ? CHECK_FOR_PLAYER_BEFORE_HEADING_CORRIDOR_NEXT
$ -> CHECK_FOR_PLAYER_BEFORE_HEADING_CORRIDOR_NEXT = SEE -> PLAYER ? PLAYER_SPOTTED / WAITFOR_REACH_CORRIDOR, HEADING_CORRIDOR_CONDITIONNAL
$ -> WAITFOR_REACH_CORRIDOR = WAITFOR -> PLAYER_CLOSER_THAN:5 ? PLAYER_SEEN_WHILE_GOING_CORRIDOR_SECOND_VERIFICATION
$ -> PLAYER_SEEN_WHILE_GOING_CORRIDOR_SECOND_VERIFICATION = SEE -> PLAYER ? PLAYER_SPOTTED / WAITFOR_REACH_CORRIDOR
$ -> PLAYER_SPOTTED = GOTO -> CAMERA:FIX, FACING_PLAYER:OBJECT, MEMORY:SECOND_INTRUSION_IN_MIAOUSS_DESK, AFFECTING:OBJ-18*DETECTION_PLAYER_WITHIN_OR_OUTSIDE_MIAOUSS_DESK

$ -> SECOND_INTRUSION = GOTO -> LEAVE_CHAIR_CONDITIONNAL_PRE, FAST:14-44, AFFECTING:OBJ-19*MIAOUSS_SECOND_INTRUSION
$ -> HEADING_CORRIDOR_CONDITIONNAL = MEMORY -> SECOND_INTRUSION_IN_MIAOUSS_DESK ? WAITFOR_HEADING_CORRIDOR / SLOW:19-44


//// COMPUTER ////

$ -> CREATE_COMPUTER_HANDLER = GOTO -> CREATE_COMPUTER, AFFECTING:OBJ-20*INIT_MIAOUSS_COMPUTER_AND_CHAIR
$ -> DELETE_COMPUTER = DELETE -> 9-44:WORLD,1
$ -> CREATE_COMPUTER = CREATE -> 9-44-FRONT:20-255-255
! -> MIAOUSS_FALLING_PLANT = GOTO -> FACING:DOWN, WAITING_FALLING_PLANT
$ -> WAITING_FALLING_PLANT = WAITFOR -> TIMER:1 ? MEMORY:FALLEN_MIAOUSS_PLANT, FACING:LEFT, WAITING_FALLING_PLANT_INQUERY
$ -> WAITING_FALLING_PLANT_INQUERY = WAITFOR -> TIMER:1 ? SLOW:12-44
$ -> WAITFOR_WATCHING_FALLEN_PLANT = WAITFOR -> TIMER:2 ? SLOW:12-45
GOAL -> 12-45 = WAITFOR -> SLOW:11-45 ? FACING:DOWN

//// SPOTTED WITHING DESK ////

! -> PLAYER_SPOTTED_WITHING_MIAOUSS_DESK = GOTO -> MOVE:STOP, CUTSCENE:START, TALK:POLICEMAN*PLAYER_SPOTTED_MIAOUSS_WITHIN_DESK
SELFTALKING -> POLICEMAN*PLAYER_SPOTTED_MIAOUSS_WITHIN_DESK = AFFECTING -> LEAVE_MIAOUSS_DESK
! -> LEAVE_MIAOUSS_DESK = FACING -> LEFT ? SLOW:12-43, PLAYER_AVOIDER_TYPE:THROUGH / PLAYER_AVOIDER_TYPE:THROUGH
GOAL -> 12-43 = GOTO -> MOVE:STOP, FACING:DOWN
! -> PLAYER_LEFT_MIAOUSS_DESK = SLOW -> 12-44
GOAL -> 12-44 = MEMORY -> FALLEN_MIAOUSS_PLANT ? FACING:DOWN, EXPRESSION:SUSPENSION, WAITFOR_WATCHING_FALLEN_PLANT / LOCKING_MIAOUSS_DOOR
$ -> LOCKING_MIAOUSS_DOOR = GOTO -> BLOCKING_PATH:TRUE, MOVE:STOP, FACING:RIGHT, PLAYER_AVOIDER_TYPE:FORCE, MOVE_PLAYER_OUT_OF_DOOR_CONDITIONNAL, WAITFOR_LOCKING_DOOR
$ -> MOVE_PLAYER_OUT_OF_DOOR_CONDITIONNAL = PLAYER_CLOSER_THAN -> 2 ? AFFECTING:PLAYER*LEAVE_MIAOUSS_DESK / NULL
$ -> WAITFOR_LOCKING_DOOR = WAITFOR -> TIMER:1 ? LOCK_DOOR_HANDLER, CAMERA:PLAYER_FLUID, MEMORY:SECOND_INTRUSION_IN_MIAOUSS_DESK, CUTSCENE:STOP, SLOW:9-43
$ -> LOCK_DOOR_HANDLER = GOTO -> DELETE_DOOR, LOCK_DOOR, LOCK_DOOR_ANIMATION, SOUND:DOOR_UNLOCK
$ -> DELETE_DOOR = DELETE -> 13-44:WORLD,1
$ -> LOCK_DOOR = CREATE -> 13-44-FRONT:1-255-1
$ -> LOCK_DOOR_ANIMATION = CREATE -> 13-44-FRONT:1-128-2
GOAL -> 9-43 = GOTO -> MOVE:STOP, DELETE_COMPUTER, SIT, TP:9-44, SOUND_IF_CAMERA:JUMP


//// SPOTTED OUTSIDE DESK ////

! -> PLAYER_SPOTTED_OUTSIDE_MIAOUSS_DESK = GOTO -> MOVE:STOP, TALK:POLICEMAN*PLAYER_SPOTTED_MIAOUSS_IN_CORRIDOR
TALKED -> POLICEMAN*PLAYER_SPOTTED_MIAOUSS_IN_CORRIDOR = GOTO -> CUTSCENE:START, SLOW:12-44
GOAL -> 19-44 = GOTO -> AFFECTING:OBJ-18*TIMER_BEFORE_MIAOUSS_LEAVING_CORRIDOR, AFFECTING:OBJ-18*TIMER_BEFORE_MIAOUSS_LEAVING_CORRIDOR
! -> GOES_BACK_TO_HIS_DESK = SLOW -> 9-43