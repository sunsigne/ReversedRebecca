TIME -> 0 = GOTO -> NAME:MIAOUSS, TEXTURE_NAME:POLICEMAN, PLAYER_AVOIDER_TYPE:STOP, WAITFOR_STUN:FALSE, BLOCKING_SIGHT:TRUE, SIT


//// STATE ////

$ -> SIT = GOTO -> FACING:RIGHT, CONDITION:SIT, DISPLAY_SIT
$ -> DISPLAY_NORMAL = DISPLAY -> 0, 0
$ -> DISPLAY_SIT = DISPLAY -> -1, -3
! -> FACING_UP = FACING -> UP
! -> FACING_DOWN = FACING -> DOWN
! -> FACING_RIGHT = FACING -> RIGHT
! -> EXPRESSION_SUSPENSION = EXPRESSION -> SUSPENSION


//// INTRUSION ////

WONPUZZLE -> 13-44 = GOTO -> EXPRESSION:EXCLAMATION, WAITFOR_LEAVING_CHAIR
$ -> WAITFOR_LEAVING_CHAIR = WAITFOR -> TIMER:1 ? LEAVE_CHAIR_CONDITIONNAL_PRE
$ -> LEAVE_CHAIR_CONDITIONNAL_PRE = CONDITION -> GOOD ? LEAVE_CHAIR_CONDITIONNAL / TP:9-43, DISPLAY_NORMAL, CONDITION:GOOD, LEAVE_CHAIR_CONDITIONNAL
$ -> LEAVE_CHAIR_CONDITIONNAL = SEE -> PLAYER ? PLAYER_SPOTTED / SLOW:13-44, WAITFOR_REACH_DOOR
$ -> WAITFOR_REACH_DOOR = WAITFOR -> PLAYER_CLOSER_THAN:5 ? PLAYER_SEEN_WHILE_GOING_DOOR_SECOND_VERIFICATION
$ -> PLAYER_SEEN_WHILE_GOING_DOOR_SECOND_VERIFICATION = SEE -> PLAYER ? PLAYER_SPOTTED / WAITFOR_REACH_DOOR
GOAL -> 13-44 = SEE -> PLAYER ? PLAYER_SPOTTED / SLOW:14-44
GOAL -> 14-44 = SEE -> PLAYER ? PLAYER_SPOTTED / WAITFOR_BEFORE_SUSPENSION_IN_FRONT_OF_DESK
$ -> WAITFOR_BEFORE_SUSPENSION_IN_FRONT_OF_DESK = WAITFOR -> TIMER:1 ? WAITFOR_HEADING_CORRIDOR_CONDITIONNAL
$ -> WAITFOR_HEADING_CORRIDOR_CONDITIONNAL = SEE -> PLAYER ? PLAYER_SPOTTED / EXPRESSION:SUSPENSION, WAITFOR_HEADING_CORRIDOR
$ -> WAITFOR_HEADING_CORRIDOR = WAITFOR -> TIMER:1 ? CHECK_FOR_PLAYER_BEFORE_HEADING_CORRIDOR
$ -> CHECK_FOR_PLAYER_BEFORE_HEADING_CORRIDOR = SEE -> PLAYER ? PLAYER_SPOTTED / WAITFOR_HEADING_CORRIDOR_NEXT
$ -> WAITFOR_HEADING_CORRIDOR_NEXT = WAITFOR -> TIMER:1 ? CHECK_FOR_PLAYER_BEFORE_HEADING_CORRIDOR_NEXT
$ -> CHECK_FOR_PLAYER_BEFORE_HEADING_CORRIDOR_NEXT = SEE -> PLAYER ? PLAYER_SPOTTED / SLOW:19-44, WAITFOR_REACH_CORRIDOR
$ -> WAITFOR_REACH_CORRIDOR = WAITFOR -> PLAYER_CLOSER_THAN:5 ? PLAYER_SEEN_WHILE_GOING_CORRIDOR_SECOND_VERIFICATION
$ -> PLAYER_SEEN_WHILE_GOING_CORRIDOR_SECOND_VERIFICATION = SEE -> PLAYER ? PLAYER_SPOTTED / WAITFOR_REACH_CORRIDOR


//// SPOTTED WITHING ////

$ -> PLAYER_SPOTTED = GOTO -> CAMERA:FIX, FACING_PLAYER:OBJECT, AFFECTING:OBJ-18*DETECTION_PLAYER_WITHIN_OR_OUTSIDE_MIAOUSS_DESK


//// SPOTTED WITHING DESK ////

! -> PLAYER_SPOTTED_WITHING_MIAOUSS_DESK = GOTO -> MOVE:STOP, CUTSCENE:START, TALK:POLICEMAN*PLAYER_SPOTTED_MIAOUSS_WITHIN_DESK
SELFTALKING -> POLICEMAN*PLAYER_SPOTTED_MIAOUSS_WITHIN_DESK = CHOICE -> PLAYER : (LEAVE)LEAVE_MIAOUSS_DESK, (STAY)OBJECT*STAY_IN_MIAOUSS_DESK
! -> STAY_IN_MIAOUSS_DESK = GOTO -> EXPRESSION:SUSPENSION, WAITFOR_STAY_IN_MIAOUSS_DESK
$ -> WAITFOR_STAY_IN_MIAOUSS_DESK = WAITFOR -> TIMER:2 ? SLOW:PLAYER, WAITFOR_TALK_PLAYER_SPOTTED_MIAOUSS_WITHIN_DESK_BUT_STAYING
$ -> WAITFOR_TALK_PLAYER_SPOTTED_MIAOUSS_WITHIN_DESK_BUT_STAYING = WAITFOR -> TIMER:2 ? BLOCKING_PATH:FALSE, TALK:POLICEMAN*PLAYER_SPOTTED_MIAOUSS_WITHIN_DESK_BUT_STAYING
SELFTALKING -> POLICEMAN*PLAYER_SPOTTED_MIAOUSS_WITHIN_DESK_BUT_STAYING = CHOICE -> PLAYER : (LEAVE)LEAVE_MIAOUSS_DESK, (STAY)OBJECT*STAY_IN_MIAOUSS_DESK_AGAIN
! -> STAY_IN_MIAOUSS_DESK_AGAIN = WAITFOR -> TIMER:3 ? stuff

! -> PLAYER_LEFT_MIAOUSS_DESK = SLOW -> 12-44
GOAL -> 12-44 = GOTO -> BLOCKING_PATH:TRUE, MOVE:STOP, FACING:RIGHT, MOVE_PLAYER_OUT_OF_DOOR_CONDITIONNAL, WAITFOR_LOCKING_DOOR
$ -> MOVE_PLAYER_OUT_OF_DOOR_CONDITIONNAL = PLAYER_CLOSER_THAN -> 2 ? AFFECTING:PLAYER*LEAVE_MIAOUSS_DESK / NULL
$ -> WAITFOR_LOCKING_DOOR = WAITFOR -> TIMER:1 ? LOCK_DOOR_HANDLER, CAMERA:PLAYER_FLUID, CUTSCENE:STOP, SLOW:9-43
$ -> LOCK_DOOR_HANDLER = GOTO -> DELETE_DOOR, LOCK_DOOR, LOCK_DOOR_ANIMATION, SOUND:DOOR_UNLOCK
$ -> DELETE_DOOR = DELETE -> 13-44:WORLD,1
$ -> LOCK_DOOR = CREATE -> 13-44-FRONT:1-255-1
$ -> LOCK_DOOR_ANIMATION = CREATE -> 13-44-FRONT:1-128-2
GOAL -> 9-43 = GOTO -> MOVE:STOP, SIT, TP:9-44, SOUND_IF_CAMERA:JUMP


//// SPOTTED OUTSIDE DESK ////

! -> PLAYER_SPOTTED_OUTSIDE_MIAOUSS_DESK = GOTO -> MOVE:STOP, TALK:POLICEMAN*PLAYER_SPOTTED_MIAOUSS_IN_CORRIDOR
TALKED -> POLICEMAN*PLAYER_SPOTTED_MIAOUSS_IN_CORRIDOR = GOTO -> CUTSCENE:START, SLOW:12-44
GOAL -> 19-44 = GOTO -> AFFECTING:OBJ-18*TIMER_BEFORE_MIAOUSS_LEAVING_CORRIDOR, AFFECTING:OBJ-18*TIMER_BEFORE_MIAOUSS_LEAVING_CORRIDOR
! -> GOES_BACK_TO_HIS_DESK = SLOW -> 9-43