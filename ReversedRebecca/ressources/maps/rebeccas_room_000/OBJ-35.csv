TIME -> 0 = GOTO -> HITBOX_INIT, TA_INIT


//// STATE ////

$ -> HITBOX_INIT = HITBOX -> 0, 0, 16, 13
$ -> TA_INIT = TRIPLE_ACTION -> DO_PANCAKES*DO_PANCAKES


//// DO PANCAKES ////

$ -> DO_PANCAKES = GOTO -> CUTSCENE:START, PLAYER_DROP_GLASS, WAITING_BEFORE_START_COOKING
$ -> WAITING_BEFORE_START_COOKING = WAITFOR -> TIMER:1 ? CREATE_FIRE_HANDLER, WAITING_BEFORE_GOTO_FRIDGE
$ -> CREATE_FIRE_HANDLER = GOTO -> CREATE_FIRE, SOUND:LIGHTER, CREATE_GAZ_HANDLER, GAZ_CONDITIONAL
$ -> CREATE_FIRE = CREATE_ANIMATION -> ONTHESPOT-BACK:WORLD,1,1,FIRE_HOTPLATES,2,8,TRUE
$ -> WAITING_BEFORE_GOTO_FRIDGE = WAITFOR -> TIMER:1 ? AFFECTING:PLAYER*MOVE_PLAYER_TO_FRIDGE
! -> PLAYER_REACHED_FRIDGE = GOTO -> SOUND:FRIDGE_OPEN, WAITING_BEFORE_TAKING_INGREDIENT
$ -> WAITING_BEFORE_TAKING_INGREDIENT = WAITFOR -> TIMER:2 ? SOUND:GLASS, WAITING_BEFORE_GOTO_HOTPLATES
$ -> WAITING_BEFORE_GOTO_HOTPLATES  = WAITFOR -> TIMER:1 ? SOUND:FRIDGE_CLOSE, AFFECTING:PLAYER*MOVE_PLAYER_TO_HOTPLATES
$ -> CONTINUE_COOKING = WAITFOR -> TIMER:1 ? CREATE_COOKING_PANCAKES, SOUND:COOKING_PAN, WAITING_BEFORE_STOPING_GAZ_SOUND
$ -> CREATE_COOKING_PANCAKES = CREATE_DECORATION -> ONTHESPOT-BACK:WORLD,1,1,PANCAKES_00
$ -> WAITING_BEFORE_STOPING_GAZ_SOUND  = WAITFOR -> TIMER:2 ? DELETE_GAZ, WAITING_BEFORE_COOKED
$ -> WAITING_BEFORE_COOKED = WAITFOR -> TIMER:1 ? DELETE_ONTHESPOT:2, DELETE_GAZ, WAITING_BEFORE_STOP_FIRE
$ -> WAITING_BEFORE_STOP_FIRE = WAITFOR -> TIMER:4 ? DELETE_ONTHESPOT:1, PLAYER_TAKE_GLASS, PARSE_NEW_BATCH
! -> PLAYER_REACHED_TABLE = MEMORY -> SARAH_INTERACTION ? PARSE_SARAH_LEFT / ALONE_PANCAKES
$ -> PARSE_SARAH_LEFT = MEMORY -> SARAH_LEFT ? ALONE_PANCAKES / CHOICE_SHARE_PANCAKES
$ -> ALONE_PANCAKES = GOTO -> CREATE_PANCAKES, SOUND:PLATE, MEMORY:PANCAKES, MEMORY:TOP_PANCAKES_SMELL_ONLY, WAITING_BEFORE_COLD_PANCAKES, SAVE_PANCAKES_ON_TABLE, CUTSCENE:STOP
$ -> WAITING_BEFORE_COLD_PANCAKES = WAITFOR -> TIMER:40 ? MEMORY:COLD_PANCAKES
$ -> CREATE_PANCAKES  = CREATE_DECORATION -> 8-3-BACK:WORLD,1,1,PANCAKES_01
$ -> SAVE_PANCAKES_ON_TABLE = SAVE -> REGISTER, REBECCAS_ROOM*PANCAKES_ON_TABLE


//// DROP GLASS ////

$ -> PLAYER_DROP_GLASS = CONDITION_PLAYER -> GLASS ? CREATE_GLASS_HANDLER / NULL
$ -> CREATE_GLASS_HANDLER = GOTO -> CONDITION_PLAYER:GOOD, CREATE_GLASS, NAME:GLASS, SOUND:GLASS
$ -> CREATE_GLASS = CREATE_DECORATION -> 1-2-BACK:WORLD,1,1,GLASS_00
$ -> PLAYER_TAKE_GLASS = NAME -> GLASS ? DELETE_GLASS_HANDLER / NULL
$ -> DELETE_GLASS_HANDLER = GOTO -> NAME:HOTSPOTS, CONDITION_PLAYER:GLASS, DELETE_GLASS, SOUND:GLASS
$ -> DELETE_GLASS = DELETE -> 1-2:WORLD,1


//// GAZ SOUND ////

$ -> CREATE_GAZ_HANDLER = GOTO -> CREATE_GAZ, AFFECTING:OBJ-40*GAZ_INIT
$ -> CREATE_GAZ = CREATE -> 0-1-BACK:40-255-255
$ -> DELETE_GAZ = DELETE -> 0-1:WORLD,1


//// NEW BATCH ////

! -> PLAYER_REACHED_HOTPLATES = MEMORY -> NEW_BATCH ? FUTHER_PROCESS / CONTINUE_COOKING
$ -> FUTHER_PROCESS = GOTO -> PARSE_THIRD_TIME_TO_HOTPLATES, MEMORY:THIRD_TIME_TO_HOTPLATE
$ -> PARSE_THIRD_TIME_TO_HOTPLATES = MEMORY -> THIRD_TIME_TO_HOTPLATE ?  CONTINUE_COOKING / WAITING_BEFORE_START_COOKING
$ -> PARSE_NEW_BATCH = MEMORY -> NEW_BATCH ? AFFECTING:PLAYER*MOVE_PLAYER_TO_PANCAKES_TABLE / AFFECTING:PLAYER*MOVE_PLAYER_TO_TABLE


//// SARAH INTERACTION ////

$ -> CHOICE_SHARE_PANCAKES = CHOICE -> ALL_FOR_ME*ALL_FOR_ME, SHARE*SHARE_WITH_SARAH
! -> ALL_FOR_ME = GOTO -> ALONE_PANCAKES
! -> SHARE_WITH_SARAH = GOTO -> CREATE_PANCAKES, SOUND:PLATE, MEMORY:POST_ARRIVAL_PANCAKES, MEMORY:PANCAKES, MEMORY:SHARED_PANCAKES, AFFECTING:OBJ-30*PANCAKES_SPLITAGE, AFFECTING:SARAH*I_MADE_PANCAKES, SAVE_LEFT_PANCAKES_ON_TABLE, SAVE_UP_PANCAKES_ON_TABLE, CUTSCENE:STOP
$ -> SAVE_LEFT_PANCAKES_ON_TABLE = SAVE -> REGISTER, REBECCAS_ROOM*LEFT_PANCAKES_ON_TABLE
$ -> SAVE_UP_PANCAKES_ON_TABLE = SAVE -> REGISTER, REBECCAS_ROOM*UP_PANCAKES_ON_TABLE