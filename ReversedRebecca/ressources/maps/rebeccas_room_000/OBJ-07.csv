TIME -> 0 = GOTO -> HITBOX_INIT, HIGHLIGHT_INIT, TA_INIT


//// STATE ////

$ -> HITBOX_INIT = HITBOX -> 0, 3, 16, 16
$ -> HIGHLIGHT_INIT = HIGHLIGHT_ABSOLUTE -> 1, 9, 1, 2
$ -> TA_INIT = GOTO -> TA_FILL
! -> TA_NULL_BATH = TRIPLE_ACTION -> NULL


//// FILL BATH ////

$ -> TA_FILL = TRIPLE_ACTION -> CUSTOM(FILL)FILL_BATH
$ -> FILL_BATH = GOTO -> AFFECTING:OBJECT*TA_NULL_BATH, CREATE_FILLING_BATH, SAVE_BATH_WATER, SOUND:BATH_FILL, WAITING_BEFORE_FILLED
$ -> CREATE_FILLING_BATH = CREATE_ANIMATION -> 1-9-BACK:WORLD,1,2,BATH_FILLING,90,FALSE
$ -> WAITING_BEFORE_FILLED = WAITFOR -> TIMER:3 ? AFFECTING:OBJECT*TA_WASH, AFFECTING:OBJECT*HAS_EMPTIED_WASHLESS
$ -> SAVE_BATH_WATER = SAVE -> REGISTER, REBECCAS_ROOM*BATH_WATER


//// EMPTY BATH ////

$ -> EMPTY_BATH = GOTO -> AFFECTING:OBJECT*TA_NULL_BATH, CREATE_EMPTYING_BATH, UNSAVE_BATH_WATER, SOUND:BATH_EMPTY, DELETE_FILLING_BATH
$ -> CREATE_EMPTYING_BATH = CREATE_ANIMATION -> 1-9-BACK:WORLD,1,2,BATH_EMPTYING,70,FALSE
$ -> DELETE_FILLING_BATH = DELETE -> 1-9:WORLD,2
$ -> DELETE_EMPTYING_BATH = DELETE -> 1-9:WORLD,1
$ -> UNSAVE_BATH_WATER = SAVE -> CANCEL_REGISTER, REBECCAS_ROOM*BATH_WATER


//// EMPTY WASHLESS ////

! -> HAS_EMPTIED_WASHLESS = MEMORY -> EMPTIED_WASHLESS ? ACTION_TWO:NULL / ACTION_TWO:CUSTOM(EMPTY)EMPTY_BATH_WASHLESS
$ -> EMPTY_BATH_WASHLESS = GOTO -> EMPTY_BATH, NOTIFY_INCONSISTENCY, WAITING_BEFORE_WASHLESS_EMPTIED
$ -> NOTIFY_INCONSISTENCY = GOTO -> CUTSCENE:START, EXPRESSION_PLAYER:SUSPENSION, MEMORY:EMPTIED_WASHLESS
$ -> WAITING_BEFORE_WASHLESS_EMPTIED = WAITFOR -> TIMER:4 ? DELETE_EMPTYING_BATH, WAITING_BEFORE_INTERROGATION
$ -> WAITING_BEFORE_INTERROGATION = WAITFOR -> TIMER:2 ? TALK:OBJECT*BATH_EMPTY_WASHLESS
TALKED -> OBJECT*BATH_EMPTY_WASHLESS = GOTO -> CUTSCENE:STOP, TA_FILL


//// EMPTY AFTER WASH ////

$ -> EMPTY_BATH_AFTER_WASH = GOTO -> EMPTY_BATH, WAITING_BEFORE_EMPTIED
$ -> WAITING_BEFORE_EMPTIED = WAITFOR -> TIMER:4 ? DELETE_EMPTYING_BATH, CREATE_HAIR_HANDLER


//// WASH ////

! -> TA_WASH = TRIPLE_ACTION -> CUSTOM(WASH)WASH
$ -> WASH = GOTO -> AFFECTING:OBJECT*TA_NULL_BATH, AFFECTING:OBJECT*BLOCKING_PATH_BATH_FALSE, PLAYER_GET_NAKED, PLAYER_ENTER_BATH, WAITING_BEFORE_CLEANED
! -> BLOCKING_PATH_BATH_FALSE = BLOCKING_PATH -> FALSE
$ -> PLAYER_GET_NAKED = GOTO -> PLAYER_DROP_GLASS, CREATE_CLOTHES_HANDLER, CONDITIONNAL_PLAYER_IN_TOWEL_WITH_SARAH, AFFECTING:NAME_PLAYER_REBECCA_TOWEL
$ -> CONDITIONNAL_PLAYER_IN_TOWEL_WITH_SARAH = MEMORY -> SARAH_INTERACTION ? MEMORY:PLAYER_IN_TOWEL_WITH_SARAH / NULL
$ -> PLAYER_ENTER_BATH = STATE_PLAYER -> 1-9,0,0,LEFT,BATH, SOUND:BATH_ENTER
$ -> WAITING_BEFORE_CLEANED = WAITFOR -> TIMER:4 ? CREATE_BATH_LEAVER_HANDLER
$ -> CREATE_BATH_LEAVER_HANDLER = GOTO -> CREATE_BATH_LEAVER, AFFECTING:OBJ-08*BATH_LEAVER_INIT
$ -> CREATE_BATH_LEAVER = CREATE -> 0-9-BACK:8-255-255


//// DROP GLASS ////

$ -> PLAYER_DROP_GLASS = CONDITION_PLAYER -> GLASS ? CREATE_GLASS_HANDLER / NULL
$ -> CREATE_GLASS_HANDLER = GOTO -> AFFECTING:HAS_NO_WATER, AFFECTING:GLASS_ON_SINK, CREATE_GLASS, SAVE_GLASS_ON_SINK, SOUND:GLASS
$ -> CREATE_GLASS = CREATE_DECORATION -> 3-8-BACK:WORLD,1,1,GLASS,7-12,1-1
$ -> SAVE_GLASS_ON_SINK = SAVE -> REGISTER, REBECCAS_ROOM*GLASS_ON_SINK


//// CREATE CLOTHES ////

$ -> CREATE_CLOTHES_HANDLER = GOTO -> CREATE_CLOTHES, AFFECTING:OBJ-09*CLOTHES_INIT
$ -> CREATE_CLOTHES = CREATE -> 2-7-BACK:9-255-255


//// EXIT WASH ////

! -> BLOCKING_PATH_BATH_TRUE = BLOCKING_PATH -> TRUE
! -> TA_EMPTY_BATH_AFTER_WASH = TRIPLE_ACTION -> CUSTOM(EMPTY)EMPTY_BATH_AFTER_WASH


//// CLEAN HAIR ////

$ -> CREATE_HAIR_HANDLER = GOTO -> CREATE_HAIR, SAVE_BATH_HAIR, AFFECTING:OBJECT*TA_CLEAN_HAIR
! -> TA_CLEAN_HAIR = TRIPLE_ACTION -> CUSTOM(CLEAN_HAIR)CLEAN_HAIR
$ -> CLEAN_HAIR = GOTO -> AFFECTING:OBJECT*TA_NULL_BATH, UNSAVE_BATH_HAIR, SOUND:CLOTHES, DELETE_HAIR
$ -> CREATE_HAIR = CREATE_DECORATION -> 1-9-BACK:WORLD,1,2,BATH,0-0,1-2
$ -> DELETE_HAIR = DELETE -> 1-9:WORLD,1
$ -> SAVE_BATH_HAIR = SAVE -> REGISTER, REBECCAS_ROOM*BATH_HAIR
$ -> UNSAVE_BATH_HAIR = SAVE -> CANCEL_REGISTER, REBECCAS_ROOM*BATH_HAIR