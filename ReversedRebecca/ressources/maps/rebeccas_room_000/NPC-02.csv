TIME -> 0 = GOTO -> NAME:SARAH, PLAYER_AVOIDER_TYPE:CUTSCENE


//// STATE ////

! -> SARAH_ON_THE_WAY = WAITFOR -> TIMER:100 ? PARSE_VISITED
$ -> PARSE_VISITED = MEMORY -> VISITED ? NULL / TRY_ARRIVING
$ -> TA_NULL = TRIPLE_ACTION -> NULL


//// TRY ARRIVING ////

$ -> TRY_ARRIVING = READY_PLAYER -> FALSE ? WAITING_BEFORE_ARRIVING / AFFECTING:SARAH_ARRIVAL
$ -> WAITING_BEFORE_ARRIVING = WAITFOR -> TIMER:1 ? TRY_ARRIVING

//// DOOR KNOCKING ////

! -> SARAH_ARRIVAL = GOTO -> CUTSCENE:START, SOUND:DOOR_KNOCK, MUSIC:NULL, WAITING_BEFORE_REALISATION, AFFECTING:SOMEONE_JUST_KNOCKED, MEMORY:VISITED
$ -> WAITING_BEFORE_REALISATION = WAITFOR -> TIMER:2 ? PLAYER_REALIZE
$ -> PLAYER_REALIZE = GOTO -> FACING_PLAYER:DOWN, EXPRESSION_PLAYER:EXCLAMATION, CUTSCENE:STOP_WITH_DELAY, WAITING_BEFORE_KNOCKING_AGAIN
$ -> WAITING_BEFORE_KNOCKING_AGAIN = WAITFOR -> TIMER:4 ? SOUND:DOOR_KNOCK, WAITING_BEFORE_KNOCKING_LAST_TIME
$ -> WAITING_BEFORE_KNOCKING_LAST_TIME = WAITFOR -> TIMER:6 ? SOUND:DOOR_KNOCK, WAITING_BEFORE_TOO_LATE
$ -> WAITING_BEFORE_TOO_LATE = WAITFOR -> TIMER:11 ? AFFECTING:TOO_LATE_AT_DOOR, MEMORY:BUT_NOBODY_CAME


//// NOBODY CAME ////

$ -> WAITING_BEFORE_NOBODY_REALISATION = WAITFOR -> TIMER:2 ? EXPRESSION_PLAYER:SUSPENSION, WAITING_BEFORE_ABANDONMENT
$ -> WAITING_BEFORE_ABANDONMENT = WAITFOR -> TIMER:2 ? TALK:DOOR_TOO_LATE_OPEN
TALKED -> DOOR_TOO_LATE_OPEN = GOTO -> AFFECTING:BLOCKING_PATH_ENTRANCE_TRUE, CUTSCENE:STOP


//// ENTERING ////

! -> SARAH_STOP_KNOCKING = WAITFOR -> TIMER:30 ? MEMORY:SORRY_FOR_THE_WAIT
! -> SARAH_ENTER = MEMORY -> BUT_NOBODY_CAME ? WAITING_BEFORE_NOBODY_REALISATION / SLOW:6-2, MUSIC_WITHOUT_TRANSITION:SARAH_THEME
GOAL -> 6-2 = GOTO -> PARSE_PANCAKES_NOT_PROPOSED_ENTERING
$ -> PARSE_PANCAKES_NOT_PROPOSED_ENTERING = MEMORY -> PANCAKES_NOT_PROPOSED ? PANCAKES_NOT_PROPOSED / ENTERING_CASE
$ -> ENTERING_CASE = GOTO -> AFFECTING:BLOCKING_PATH_ENTRANCE_TRUE, AFFECTING:PLAYER_TOWEL_ANALYZER, MEMORY:SARAH_ENTERED, CHOOSE_GREETING
$ -> CHOOSE_GREETING = CHOICE -> GREET*GREET_SARAH, HUG*HUG_SARAH_CONDITIONNAL


//// GREET SARAH ////

! -> GREET_SARAH = MEMORY -> SORRY_FOR_THE_WAIT ? PARSE_SARAH_GREET_WAIT / PARSE_SARAH_GREET_NO_WAIT
$ -> PARSE_SARAH_GREET_WAIT = MEMORY -> PLAYER_IN_TOWEL_WITH_SARAH ? PARSE_SARAH_GREET_WAIT_TOWEL / PARSE_SARAH_GREET_WAIT_NO_TOWEL
$ -> PARSE_SARAH_GREET_NO_WAIT = MEMORY -> PLAYER_IN_TOWEL_WITH_SARAH ? PARSE_SARAH_GREET_NO_WAIT_TOWEL / PARSE_SARAH_GREET_NO_WAIT_NO_TOWEL
$ -> PARSE_SARAH_GREET_NO_WAIT_NO_TOWEL = MEMORY -> PANCAKES ? TALK:SARAH_GREET_PANCAKES / TALK:SARAH_GREET
$ -> PARSE_SARAH_GREET_WAIT_NO_TOWEL = MEMORY -> PANCAKES ? TALK:SARAH_GREET_WAIT_PANCAKES / TALK:SARAH_GREET_WAIT
$ -> PARSE_SARAH_GREET_NO_WAIT_TOWEL = MEMORY -> PANCAKES ? TALK:SARAH_GREET_TOWEL_PANCAKES / TALK:SARAH_GREET_TOWEL
$ -> PARSE_SARAH_GREET_WAIT_TOWEL = MEMORY -> PANCAKES ? TALK:SARAH_GREET_WAIT_TOWEL_PANCAKES / TALK:SARAH_GREET_WAIT_TOWEL

TALKED -> SARAH_GREET = GOTO -> WANNA_GO
TALKED -> SARAH_GREET_WAIT = GOTO -> WANNA_GO
TALKED -> SARAH_GREET_TOWEL = GOTO -> WANNA_GO
TALKED -> SARAH_GREET_WAIT_TOWEL = GOTO -> WANNA_GO
TALKED -> SARAH_GREET_PANCAKES = MEMORY -> PANCAKES_SMELL_ONLY ? WAITING_BEFORE_SEARCHING_PANCAKES_IN_KITCHEN / WAITING_BEFORE_SEARCHING_PANCAKES_ON_TABLE
TALKED -> SARAH_GREET_WAIT_PANCAKES = MEMORY -> PANCAKES_SMELL_ONLY ? WAITING_BEFORE_SEARCHING_PANCAKES_IN_KITCHEN / WAITING_BEFORE_SEARCHING_PANCAKES_ON_TABLE
TALKED -> SARAH_GREET_TOWEL_PANCAKES = MEMORY -> PANCAKES_SMELL_ONLY ? WAITING_BEFORE_SEARCHING_PANCAKES_IN_KITCHEN / WAITING_BEFORE_SEARCHING_PANCAKES_ON_TABLE
TALKED -> SARAH_GREET_WAIT_TOWEL_PANCAKES = MEMORY -> PANCAKES_SMELL_ONLY ? WAITING_BEFORE_SEARCHING_PANCAKES_IN_KITCHEN / WAITING_BEFORE_SEARCHING_PANCAKES_ON_TABLE



//// HUG SARAH ////

! -> HUG_SARAH_CONDITIONNAL = MEMORY -> PLAYER_IN_TOWEL_WITH_SARAH ? REFUSING_HUG / ACCEPTING_HUG
$ -> REFUSING_HUG = GOTO -> FAST:5-2, SOUND:JUMP, AFFECTING:MOVE_PLAYER_TO_ENTRANCE, MEMORY:SARAH_REFUSED_HUG
GOAL -> 5-2 = MEMORY -> PANCAKES_NOT_PROPOSED ? PANCAKES_NOT_PROPOSED / FACING:RIGHT, WAITING_BEFORE_HUG_QUESTIONNING
$ -> WAITING_BEFORE_HUG_QUESTIONNING = WAITFOR -> TIMER:1 ? PARSE_SARAH_HUG_TOWEL_PANCAKES 
$ -> PARSE_SARAH_HUG_TOWEL_PANCAKES = MEMORY -> PANCAKES ? TALK:SARAH_HUG_TOWEL_PANCAKES / TALK:SARAH_HUG_TOWEL
TALKED -> SARAH_HUG_TOWEL = GOTO -> WANNA_GO
TALKED -> SARAH_HUG_TOWEL_PANCAKES = MEMORY -> PANCAKES_SMELL_ONLY ? WAITING_BEFORE_SEARCHING_PANCAKES_IN_KITCHEN_POST_TOWEL_HUG / WAITING_BEFORE_SEARCHING_PANCAKES_ON_TABLE_POST_TOWEL_HUG

$ -> ACCEPTING_HUG = GOTO -> AFFECTING:HIDE_PLAYER, HIDE_SARAH, CREATE_HUG, SOUND:JUMP, WAITING_BEFORE_HUG_TALKING, MEMORY:LOVE_HUG
$ -> WAITING_BEFORE_HUG_TALKING = WAITFOR -> TIMER:1 ? TALK:SARAH_HUG
TALKED -> SARAH_HUG = WAITFOR -> TIMER:1 ? DELETE_HUG, AFFECTING:UNHIDE_PLAYER, UNHIDE_SARAH, WAITING_BEFORE_POST_HUG_TALKING
$ -> WAITING_BEFORE_POST_HUG_TALKING = WAITFOR -> TIMER:1 ? PARSE_SARAH_HUG_PANCAKES
$ -> PARSE_SARAH_HUG_PANCAKES = MEMORY -> PANCAKES ? TALK:SARAH_HUG_PANCAKES / TALK:SARAH_HUG_WANNA_GO
$ -> HIDE_SARAH = TP -> 0-16
$ -> UNHIDE_SARAH = TP -> 6-2
$ -> CREATE_HUG = CREATE_DECORATION -> 6-2-BACK:1,2,REBECCA_SARAH_HUG
$ -> DELETE_HUG = DELETE -> 6-2:1
$ -> PARSE_SARAH_HUG = MEMORY 
TALKED -> SARAH_HUG_WANNA_GO = GOTO -> WANNA_GO
TALKED -> SARAH_HUG_PANCAKES = MEMORY -> PANCAKES_SMELL_ONLY ? WAITING_BEFORE_SEARCHING_PANCAKES_IN_KITCHEN / WAITING_BEFORE_SEARCHING_PANCAKES_ON_TABLE


//// SEARCH PANCAKES ////

$ -> WAITING_BEFORE_SEARCHING_PANCAKES_IN_KITCHEN = WAITFOR -> TIMER:1 ? MOVE:5-3
$ -> WAITING_BEFORE_SEARCHING_PANCAKES_IN_KITCHEN_POST_TOWEL_HUG = WAITFOR -> TIMER:1 ? MOVE:3-3
$ -> WAITING_BEFORE_SEARCHING_PANCAKES_ON_TABLE = WAITFOR -> TIMER:1 ? MOVE:8-2
$ -> WAITING_BEFORE_SEARCHING_PANCAKES_ON_TABLE_POST_TOWEL_HUG = WAITFOR -> TIMER:1 ? MOVE:6-3
GOAL -> 5-3 = MEMORY -> PANCAKES_NOT_PROPOSED ? PANCAKES_NOT_PROPOSED / MOVE:3-3
GOAL -> 3-3 = WAITFOR -> TIMER:1 ? TALK:SARAH_PANCAKES_SEARCH_KITCHEN
GOAL -> 8-2 = MEMORY -> TRY_TO_SIT ? SIT / TALK:SARAH_PANCAKES_SEARCH_TABLE_DOWN
TALKED -> SARAH_PANCAKES_SEARCH_KITCHEN = CHOICE -> MAKE_SOME*PANCAKES_MAKE_SOME, WERE_TASTY*PANCAKES_WERE_TASTY
TALKED -> SARAH_PANCAKES_SEARCH_TABLE_DOWN = CHOICE -> WE_SHARE*PANCAKES_SHARE, YES_I_KNOW*PACAKES_SMELL_GOOD
TALKED -> SARAH_PANCAKES_SEARCH_TABLE_RIGHT = CHOICE -> WE_SHARE*PANCAKES_SHARE, YES_I_KNOW*PACAKES_SMELL_GOOD
! -> PANCAKES_WERE_TASTY = TALK -> SARAH_PANCAKES_NOT_PROPOSED
! -> PACAKES_SMELL_GOOD = TALK -> SARAH_PANCAKES_NOT_PROPOSED
TALKED -> SARAH_PANCAKES_NOT_PROPOSED = WAITFOR -> TIMER:1 ? MEMORY:PANCAKES_NOT_PROPOSED, PARSE_POS_AFTER_NOT_PROPOSED
$ -> PARSE_POS_AFTER_NOT_PROPOSED = FACING -> LEFT ? MOVE:6-2 / PARSE_SECOND_POSSIBILITY_NOT_PROPOSED 
$ -> PARSE_SECOND_POSSIBILITY_NOT_PROPOSED = FACING -> RIGHT ? PARSE_NOT_PROPOSED_TOWEL / MOVE:6-3
$ -> PARSE_NOT_PROPOSED_TOWEL = MEMORY -> SARAH_REFUSED_HUG ? MOVE:5-2 / MOVE:5-3
GOAL -> 6-3 = MEMORY -> PANCAKES_NOT_PROPOSED ? PANCAKES_NOT_PROPOSED / FACING_PLAYER:DOWN, TALK:SARAH_PANCAKES_SEARCH_TABLE_RIGHT
$ -> PANCAKES_NOT_PROPOSED = GOTO ->  TALK:SARAH_PANCAKES_NOT_PROPOSED_NEXT
TALKED -> SARAH_PANCAKES_NOT_PROPOSED_NEXT = GOTO -> FACING_PLAYER:SARAH, WANNA_GO

! -> PANCAKES_SHARE = GOTO -> GOOD_DEED:SHARE_PANCAKES, SAVE_PANCAKES_GIVEN, TALK:SARAH_PANCAKES_WE_SHARE
TALKED -> SARAH_PANCAKES_WE_SHARE = WAITFOR -> TIMER:1 ? PARSE_TABLE_POS, AFFECTING:MOVE_PLAYER_TO_BUFFET
$ -> PARSE_TABLE_POS  = FACING -> DOWN ? SIT / MOVE:8-2, MEMORY:TRY_TO_SIT
$ -> SIT = GOTO -> PLAYER_AVOIDER_TYPE:CUTSCENE, AFFECTING:BLOCKING_PATH_CHAIR_TOWARD_DOWN_FALSE, TP:9-2, DISPLAY_SIT, FACING:DOWN, CONDITION:SIT, SOUND:JUMP
$ -> DISPLAY_SIT = DISPLAY -> 0, -1
! -> PLAYER_REACHED_BUFFET = WAITFOR -> TIMER:1 ? SOUND:PLATE, WAITING_BEFORE_PLAYER_BRINGING_PLATE
$ -> WAITING_BEFORE_PLAYER_BRINGING_PLATE = WAITFOR -> TIMER:1 ? AFFECTING:MOVE_PLAYER_TO_PANCAKES_TABLE
! -> PLAYER_REACHED_PANCAKES_TABLE = WAITFOR -> TIMER:1 ? PARSE_NEW_BATCH
$ -> DISPOSE_NEW_BATCH = GOTO -> AFFECTING:PANCAKES_CREATE_SARAH, WAITING_BEFORE_PLAYER_SITTING
$ -> WAITING_BEFORE_PLAYER_SITTING = WAITFOR -> TIMER:1 ? AFFECTING:PLAYER_SITTING_TO_PANCAKES, WAITING_BEFORE_TALK_PANCAKES_EATING_THANK
$ -> PLAYER_SITTING = STATE_PLAYER -> 7-3,2,-1,RIGHT,SIT, SOUND:JUMP
$ -> WAITING_BEFORE_TALK_PANCAKES_EATING_THANK = WAITFOR -> TIMER:1 ? TALK:SARAH_PANCAKES_EATING_THANK
TALKED -> SARAH_PANCAKES_EATING_THANK = WAITFOR -> TIMER:1 ? PARSE_NEW_BATCH_AGAIN

! -> PANCAKES_MAKE_SOME = GOTO -> GOOD_DEED:OFFER_PANCAKES, SAVE_PANCAKES_GIVEN, TALK:SARAH_PANCAKES_MAKE_MORE
TALKED -> SARAH_PANCAKES_MAKE_MORE = WAITFOR -> TIMER:1 ? PARSE_TABLE_POS, MEMORY:NEW_BATCH, AFFECTING:MOVE_PLAYER_TO_HOTPLATES
$ -> PARSE_NEW_BATCH = MEMORY -> NEW_BATCH ? DISPOSE_NEW_BATCH / SLIPT_PANCAKES
$ -> SLIPT_PANCAKES = GOTO -> AFFECTING:PANCAKES_SPLITAGE, WAITING_BEFORE_PLAYER_SITTING 
$ -> PARSE_NEW_BATCH_AGAIN = MEMORY -> NEW_BATCH ? AFFECTING:PANCAKES_SARAH_EATING / AFFECTING:PANCAKES_REBECCA_SARAH_EATING
$ -> SAVE_PANCAKES_GIVEN = SAVE -> REGISTER, REBECCAS_ROOM*SARAH_GIVEN_PANCAKES


//// WANNA GO ////

$ -> WANNA_GO = CHOICE -> GREAT_IDEA*WANNA_GO_ACCEPT, NO_THANKS*WANNA_GO_REFUSE
! -> WANNA_GO_REFUSE = WAITFOR -> TIMER:1 ? TALK:SARAH_WANNA_GO_REFUSE
TALKED -> SARAH_WANNA_GO_REFUSE = CHOICE -> I_ACCEPT*WANNA_GO_ACCEPT_BY_GREEDNESS, ANOTHER_TIME*WANNA_GO_REFUSE_FOR_REAL
! -> WANNA_GO_REFUSE_FOR_REAL = TALK -> SARAH_WANNA_GO_REFUSE_FOR_REAL
TALKED -> SARAH_WANNA_GO_REFUSE_FOR_REAL = WAITFOR -> TIMER:1 ? FACING:RIGHT, WAITING_BEFORE_SAD_GOODBYE
$ -> WAITING_BEFORE_SAD_GOODBYE = WAITFOR -> TIMER:2 ? TALK:SARAH_WANNA_GO_REFUSE_FOR_REAL_NEXT
TALKED -> SARAH_WANNA_GO_REFUSE_FOR_REAL_NEXT = GOTO -> AFFECTING:BLOCKING_PATH_ENTRANCE_FALSE, MEMORY:SARAH_WAIT_SPACE_TO_EXIT, AFFECTING:MOVE_PLAYER_TO_SIDE_STEP_ENTRANCE, PARSE_PANCAKES_NOT_PROPOSED_LEAVING
$ -> PARSE_PANCAKES_NOT_PROPOSED_LEAVING = MEMORY -> PANCAKES_NOT_PROPOSED ? PARSE_LOVE_HUG  / NULL
$ -> PARSE_LOVE_HUG = MEMORY -> LOVE_HUG ? NULL / BAD_DEED:FRIEND_RECEIVED_BADLY, MEMORY:BAD_FRIEND
! -> PLAYER_REACHED_SIDE_STEP_ENTRANCE = MEMORY -> SARAH_WAIT_SPACE_TO_EXIT ? WAITING_BEFORE_LEAVING / NULL
$ -> WAITING_BEFORE_LEAVING = WAITFOR -> TIMER:1 ? SLOW:8-0, MUSIC:REBECCAS_ROOM
GOAL -> 8-0 = GOTO -> AFFECTING:BLOCKING_PATH_ENTRANCE_TRUE, CUTSCENE:STOP

! -> WANNA_GO_ACCEPT_BY_GREEDNESS = TALK -> SARAH_WANNA_GO_ACCEPT_BY_GREEDNESS
! -> WANNA_GO_ACCEPT = TALK -> SARAH_WANNA_GO_ACCEPT
TALKED -> SARAH_WANNA_GO_ACCEPT_BY_GREEDNESS = GOTO -> CUTSCENE:STOP, START_IA
TALKED -> SARAH_WANNA_GO_ACCEPT = GOTO -> CUTSCENE:STOP, START_IA
TALKED -> SARAH_PANCAKES_EATING_SHARED_FINISHED = GOTO -> MEMORY:SAT, START_IA
TALKED -> SARAH_PANCAKES_EATING_FINISHED = GOTO -> MEMORY:SAT, START_IA
$ -> WAITING_BEFORE_STANDING_UP = WAITFOR -> TIMER:2 ? WAITING_SPACE_BEFORE_STANDING_UP
$ -> WAITING_SPACE_BEFORE_STANDING_UP = WAITFOR -> PLAYER_FUTHER_THAN:2 ? AFFECTING:BLOCKING_PATH_CHAIR_TOWARD_DOWN_TRUE, AFFECTING:DOWN_CHAIR_INIT, TP:8-2, DISPLAY_NORMAL, FACING:LEFT, CONDITION:GOOD, SOUND:JUMP, A1_READY, MOVE_TO_CAMILLE 
$ -> DISPLAY_NORMAL = DISPLAY -> 0, 0


//// START IA ////

$ -> START_IA = GOTO -> AFFECTING:SARAH_INTERACTION, MEMORY:SARAH_INTERACTION, MUSIC:REBECCAS_ROOM, PARSE_SAT
$ -> PARSE_SAT = MEMORY -> SAT ? WAITING_BEFORE_STANDING_UP / WAITING_BEFORE_TA_READY
$ -> WAITING_BEFORE_TA_READY = WAITFOR -> TIMER:1 ? A3_READY, WAITING_BEFORE_WATCHING_CAMILLE


//// AM READY ////

! -> NAME_PLAYER_REBECCA_TOWEL = MEMORY -> PLAYER_IN_TOWEL_WITH_SARAH ? MEMORY:NO_LONGER_IN_TOWEL_WITH_SARAH, A3_READY / NULL
$ -> A3_READY = CONDITION -> RELAX ? PARSE_PLAYER_RELAX_IN_TOWEL_WITH_SARAH / PARSE_PLAYER_IN_TOWEL_WITH_SARAH
$ -> PARSE_PLAYER_IN_TOWEL_WITH_SARAH = MEMORY -> PLAYER_IN_TOWEL_WITH_SARAH ? PARSE_NO_LONGER_IN_TOWEL_WITH_SARAH / A3_READY
$ -> PARSE_NO_LONGER_IN_TOWEL_WITH_SARAH = MEMORY -> NO_LONGER_IN_TOWEL_WITH_SARAH ? A3_READY / PARSE_STILL_IN_TOWEL 
$ -> PARSE_STILL_IN_TOWEL = MEMORY -> STILL_IN_TOWEL ? NULL / A3_READY_TOWEL 
$ -> PARSE_PLAYER_RELAX_IN_TOWEL_WITH_SARAH = MEMORY -> PLAYER_IN_TOWEL_WITH_SARAH ? PARSE_RELAX_NO_LONGER_IN_TOWEL_WITH_SARAH / A3_READY_RELAX
$ -> PARSE_RELAX_NO_LONGER_IN_TOWEL_WITH_SARAH = MEMORY -> NO_LONGER_IN_TOWEL_WITH_SARAH ? A3_READY_RELAX / PARSE_STILL_IN_RELAX_TOWEL
$ -> PARSE_STILL_IN_TOWEL = MEMORY -> STILL_IN_TOWEL ? NULL / A3_READY_RELAX_TOWEL
$ -> A3_READY = ACTION_THREE -> I_AM_READY*SARAH_I_AM_READY
$ -> A3_READY_TOWEL = ACTION_THREE -> I_AM_READY*SARAH_I_AM_READY_TOWEL
$ -> A3_READY_RELAX = ACTION_THREE -> I_AM_READY*SARAH_I_AM_READY_RELAX
$ -> A3_READY_RELAX_TOWEL = ACTION_THREE -> I_AM_READY*SARAH_I_AM_READY_RELAX_TOWEL

$ -> SARAH_I_AM_READY_TOWEL = GOTO -> MEMORY:STILL_IN_TOWEL, TALK:SARAH_I_AM_READY_TOWEL
$ -> SARAH_I_AM_READY_RELAX_TOWEL = GOTO -> MEMORY:STILL_IN_TOWEL, TALK:SARAH_I_AM_READY_RELAX_TOWEL
$ -> SARAH_I_AM_READY = GOTO -> CUTSCENE:START, WAITING_BEFORE_I_AM_READY
$ -> SARAH_I_AM_READY_RELAX = GOTO -> CUTSCENE:START, WAITING_BEFORE_I_AM_READY_RELAX
$ -> WAITING_BEFORE_I_AM_READY = WAITFOR -> TIME:1 ? TALK:SARAH_I_AM_READY
$ -> WAITING_BEFORE_I_AM_READY_RELAX = WAITFOR -> TIME:1 ? TALK:SARAH_I_AM_READY_RELAX

TALKED -> SARAH_I_AM_READY = GOTO -> NULL
TALKED -> SARAH_I_AM_READY_RELAX = GOTO -> NULL


//// WATCH CAMILLE ////

$ -> WAITING_BEFORE_WATCHING_CAMILLE = WAITFOR -> TIMER:1 ? MOVE_TO_CAMILLE
$ -> MOVE_TO_CAMILLE = GOTO -> PLAYER_AVOIDER_TYPE:STOP, SLOW:11-5
GOAL -> 11-5 = GOTO -> PLAYER_AVOIDER_TYPE:AROUND, SLOW_BACKUP_TO_CAMILLE
$ -> SLOW_BACKUP_TO_CAMILLE = SLOW_BACKUP -> 14-7, 15-6
GOAL -> 14-7 = GOTO -> FACING:RIGHT, WAITING_BEFORE_TOILET, ACTION_ONE:TALK*CAMILLE_SARAH_REBECCA_HUMAN, MEMORY:SARAH_WATCHING_CAMILLE
GOAL -> 15-6 = GOTO -> FACING:DOWN, WAITING_BEFORE_TOILET, ACTION_ONE:TALK*CAMILLE_SARAH_REBECCA_HUMAN, MEMORY:SARAH_WATCHING_CAMILLE
TALKED -> CAMILLE = MEMORY -> SARAH_WATCHING_CAMILLE ? PARSE_SARAH_NO_LONGER_WATCHING_CAMILLE / NULL
$ -> PARSE_SARAH_NO_LONGER_WATCHING_CAMILLE = MEMORY -> SARAH_NO_LONGER_WATCHING_CAMILLE ? NULL / TALK:CAMILLE_SARAH_NOTICE
TALKED -> CAMILLE_SARAH_NOTICE = FACING -> CAMILLE
TALKED -> CAMILLE_SARAH_REBECCA_HUMAN = GOTO -> FACING:CAMILLE, ACTION_ONE:TALK*CAMILLE_SARAH_REBECCA_LIFE
TALKED -> CAMILLE_SARAH_REBECCA_LIFE = GOTO -> FACING:CAMILLE, ACTION_ONE:TALK*CAMILLE_SARAH_REBECCA_THINK, MEMORY:LIFE_DISCUSSION


//// GO TOILET ////

$ -> WAITING_BEFORE_TOILET = WAITFOR -> TIMER:15 ? MEMORY:SARAH_NO_LONGER_WATCHING_CAMILLE, TA_NULL, CREATE_SARAH_TOILET_PATH_CHECKER, AFFECTING:SARAH_TOILET_PATH_CHECKER_INIT
$ -> CREATE_SARAH_TOILET_PATH_CHECKER = CREATE -> 17-7-BACK:45-255-255
! -> SARAH_GO_TOILET = SLOW -> 18-8
GOAL -> 18-8 = MEMORY -> SARAH_ALREADY_PEE ? GOING_OUT_OF_TOILET / LOCKING_TOILET
$ -> LOCKING_TOILET = GOTO -> FACING:UP, WAITING_BEFORE_LOCKING_TOILET,
$ -> WAITING_BEFORE_LOCKING_TOILET = WAITFOR -> TIMER:1 ? PARSE_REBECCA_PRESENCE_IN_TOILET
$ -> PARSE_REBECCA_PRESENCE_IN_TOILET = SEE -> PLAYER ? REACTING_TO_REBECCA_PRESENCE / ALONE_IN_TOILET
$ -> REACTING_TO_REBECCA_PRESENCE = GOTO -> TALK:SARAH_TOILET_YOU_MIND, MEMORY:REBECCA_IN_TOILET
TALKED -> SARAH_TOILET_YOU_MIND = GOTO -> AFFECTING:PUSH_PLAYER_UP, WAITING_FOR_PLAYER_PUSHED
$ -> WAITING_FOR_PLAYER_PUSHED = WAITFOR -> PLAYER_FUTHER_THAN:2 ? ALONE_IN_TOILET
$ -> ALONE_IN_TOILET = GOTO -> PLAYER_AVOIDER_TYPE:AROUND, FACING:UP, LOCK_TOILET_DOOR, SOUND:DOOR_UNLOCK, WAITING_BEFORE_GOING_FOR_TOILET_SEAT
$ -> WAITING_BEFORE_GOING_FOR_TOILET_SEAT = WAITFOR -> TIMER:1 ? SLOW:18-9
GOAL -> 18-9 = GOTO -> SARAH_GOING_ON_SEAT, WAITING_BEFORE_DOING_STUFF, MEMORY:SARAH_ALREADY_PEE
$ -> SARAH_GOING_ON_SEAT = GOTO -> DISPLAY_TOILET, CONDITION:SIT, SOUND:JUMP, FACING:UP
$ -> DISPLAY_TOILET = DISPLAY -> 0, 12
$ -> WAITING_BEFORE_DOING_STUFF = WAITFOR -> TIMER:2 ? SOUND:TOILET_DOING, WAITING_BEFORE_FINISHED
$ -> WAITING_BEFORE_FINISHED = WAITFOR -> TIMER:3 ? SARAH_EXIT_SEAT, SLOW:17-9
$ -> SARAH_EXIT_SEAT = GOTO -> DISPLAY_NORMAL, CONDITION:GOOD, SOUND:TOILET_FLUSH
GOAL -> 17-9 = GOTO -> DISPLAY_SINK, FACING:UP, SOUND:WATER_SINK, WAITING_BEFORE_CLEANED
$ -> DISPLAY_SINK = DISPLAY -> 0, -14
$ -> DISPLAY_NORMAL = DISPLAY -> 0, 0
$ -> WAITING_BEFORE_CLEANED = WAITFOR -> TIMER:2 ? DISPLAY_NORMAL, SLOW:18-8
$ -> GOING_OUT_OF_TOILET = GOTO -> UNLOCK_TOILET_DOOR, SOUND:DOOR_UNLOCK, PARSE_REBECCA_IN_TOILET
$ -> LOCK_TOILET_DOOR = CREATE -> 18-7-FRONT:1-255-6
$ -> UNLOCK_TOILET_DOOR = DELETE -> 18-7:2


//// DISPUTE REBECCA ////

$ -> PARSE_REBECCA_IN_TOILET = MEMORY -> REBECCA_IN_TOILET ? PARSE_READY_PLAYER_DISPUTE / WAITING_BEFORE_BOOKSHELF
$ -> PARSE_READY_PLAYER_DISPUTE = READY_PLAYER -> TRUE ? START_DISPUTE / WAITING_BEFORE_START_DISPUTE
$ -> WAITING_BEFORE_START_DISPUTE = WAITFOR -> TIMER:1 ? PARSE_READY_PLAYER_DISPUTE
$ -> START_DISPUTE = GOTO -> CUTSCENE:START, AFFECTING:MOVE_PLAYER_TO_DISPUTE, SLOW:17-6
GOAL -> 17-6 = WAITFOR -> PLAYER_CLOSER_THAN:2 ? CHOICE_ABOUT_DISPUTE
$ -> CHOICE_ABOUT_DISPUTE = CHOICE -> APOLOGIZE*APOLOGIZE, SAY_NOTHING*DISPUTE_SAY_NOTHING

! -> APOLOGIZE = TALK -> SARAH_TOILET_APOLOGIZE
TALKED -> SARAH_TOILET_APOLOGIZE = GOTO -> GOOD_DEED:MAKE_AMENDS, CUTSCENE:STOP, WAITING_BEFORE_BOOKSHELF

! -> DISPUTE_SAY_NOTHING = WAITFOR -> TIMER:1 ? AFFECTING:DISPUTE_PLAYER_SAID_NOTHING
! -> SARAH_ANGRY_GOODBYE = WAITFOR -> TIMER:1 ? SLOW:14-6
GOAL -> 14-6 = WAITFOR -> TIMER:1 ? TALK:SARAH_TOILET_GOODBYE
TALKED -> SARAH_TOILET_GOODBYE = GOTO -> MOVE:12-6
TALKED -> SARAH_TOILET_GOODBYE = GOTO -> PLAYER_AVOIDER_TYPE:CUTSCENE, AFFECTING:BLOCKING_PATH_ENTRANCE_FALSE, MOVE:7-0
GOAL -> 7-0 = TALK -> REBECCA_ANGRY_ABOUT_DISPUTE
TALKED -> REBECCA_ANGRY_ABOUT_DISPUTE = GOTO -> SAVE_SARAH_ANGRY, BAD_DEED:INAPPROPRIATE_BEHAVIOR, FAST:8-0
$ -> SAVE_SARAH_ANGRY = SAVE -> REGISTER, REBECCAS_ROOM*SARAH_ANGRY_ABOUT_PRIVACY


//// WATCH BOOKSHELF ////

$ -> WAITING_BEFORE_BOOKSHELF = WAITFOR -> TIMER:1 ? SLOW:13-3, A3_READY
GOAL -> 18-6 = GOTO -> FACING:LEFT, SLOW:13-3
GOAL -> 13-3 = GOTO -> WAITING_BEFORE_SLEEPING, ACTION_ONE:TALK*SARAH_BOOK
TALKED -> SARAH_BOOK = GOTO -> FACING:UP, PARSE_LIFE_DISCUSSION
$ -> PARSE_LIFE_DISCUSSION = MEMORY -> LIFE_DISCUSSION ? ACTION_ONE:TALK_VAR*START_BOOK_LIFE_CUTSCENE / ACTION_ONE:TALK*SARAH_BOOK_HAIR
$ -> START_BOOK_LIFE_CUTSCENE = GOTO -> CUTSCENE:START, EXPRESSION:EXCLAMATION, AFFECTING:WAITING_BEFORE_BOOK_LIFE_DISCUSSION
TALKED -> SARAH_BOOK_LIFE = GOTO -> CUTSCENE:STOP, FACING:UP, ACTION_ONE:TALK*SARAH_BOOK_ROOMMATE
TALKED -> SARAH_BOOK_HAIR = GOTO -> FACING:UP, ACTION_ONE:TALK*SARAH_BOOK_ROOMMATE
TALKED -> SARAH_BOOK_ROOMMATE = FACING -> UP


//// GO SLEEPING ////

$ -> WAITING_BEFORE_SLEEPING = WAITFOR -> TIMER:20 ? SLOW:17-3
GOAL -> 17-3 = GOTO -> PUT_AT_COUCH_POS, DISPLAY_ON_COUCH, MOVE:STOP, CONDITION:BED, ACTION_ONE:WAKE_UP*SARAH_WAKE_UP 
$ -> PUT_AT_COUCH_POS = GOTO -> AFFECTING:BLOCKING_VERTICAL_COUCH_FALSE, TP:18-3, HITBOX_COUCH, SOUND:JUMP
$ -> HITBOX_NORMAL = HITBOX -> 0, 0, 16, 16
$ -> HITBOX_COUCH = HITBOX -> 0, 0, 16, 32
$ -> DISPLAY_ON_COUCH = DISPLAY -> -2, 5
$ -> SARAH_WAKE_UP = TALK -> SARAH_WAKE_UP