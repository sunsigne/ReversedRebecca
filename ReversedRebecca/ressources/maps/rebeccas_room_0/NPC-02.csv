TIME -> 0 = GOTO -> NAME:SARAH


//// STATE ////

TIME -> 100 = MEMORY -> VISITED ? NULL / TRY_ARRIVING


//// TRY ARRIVING ////

$ -> TRY_ARRIVING = CUTSCENE -> RUNNING ? WAITING_BEFORE_ARRIVING / SECOND_VERIFICATION_ARRIVING
$ -> WAITING_BEFORE_ARRIVING = WAITFOR -> TIMER:1 ? TRY_ARRIVING
$ -> SECOND_VERIFICATION_ARRIVING = CONDITION_PLAYER -> GOOD ? AFFECTING:SARAH_ARRIVAL / THIRD_VERIFICATION_ARRIVING
$ -> THIRD_VERIFICATION_ARRIVING = CONDITION_PLAYER -> GLASS ? AFFECTING:SARAH_ARRIVAL / WAITING_BEFORE_ARRIVING


//// DOOR KNOCKING ////

! -> SARAH_ARRIVAL = GOTO -> CUTSCENE:START, SOUND:DOOR_KNOCK, WAITING_BEFORE_REALISATION, AFFECTING:SOMEONE_JUST_KNOCKED, MEMORY:VISITED
$ -> WAITING_BEFORE_REALISATION = WAITFOR -> TIMER:2 ? PLAYER_REALIZE
$ -> PLAYER_REALIZE = GOTO -> FACING_PLAYER:DOWN, EXPRESSION_PLAYER:EXCLAMATION, CUTSCENE:STOP_WITH_DELAY, WAITING_BEFORE_KNOCKING_AGAIN
$ -> WAITING_BEFORE_KNOCKING_AGAIN = WAITFOR -> TIMER:4 ? SOUND:DOOR_KNOCK, WAITING_BEFORE_KNOCKING_LAST_TIME
$ -> WAITING_BEFORE_KNOCKING_LAST_TIME = WAITFOR -> TIMER:6 ? SOUND:DOOR_KNOCK, WAITING_BEFORE_TOO_LATE
$ -> WAITING_BEFORE_TOO_LATE = WAITFOR -> TIMER:7 ? AFFECTING:TOO_LATE_AT_DOOR, MEMORY:BUT_NOBODY_CAME


//// NOBODY CAME ////

$ -> WAITING_BEFORE_NOBODY_REALISATION = WAITFOR -> TIMER:2 ? EXPRESSION_PLAYER:SUSPENSION, WAITING_BEFORE_ABANDONMENT
$ -> WAITING_BEFORE_ABANDONMENT = WAITFOR -> TIMER:2 ? TALK:DOOR_TOO_LATE_OPEN
TALKED -> DOOR_TOO_LATE_OPEN = GOTO -> AFFECTING:BLOCKING_PATH_ENTRANCE_TRUE, CUTSCENE:STOP


//// ENTERING ////

! -> SARAH_STOP_KNOCKING = WAITFOR -> TIMER:30 ? MEMORY:SORRY_FOR_THE_WAIT
! -> SARAH_ENTER = MEMORY -> BUT_NOBODY_CAME ? WAITING_BEFORE_NOBODY_REALISATION / SLOW:6-2
GOAL -> 6-2 = GOTO -> AFFECTING:BLOCKING_PATH_ENTRANCE_TRUE, AFFECTING:PLAYER_TOWEL_ANALYZER, CHOOSE_GREETING
$ -> CHOOSE_GREETING = CHOICE -> GREET*GREET_SARAH, HUG*HUG_SARAH_CONDITIONNAL


//// GREET SARAH ////

! -> GREET_SARAH = MEMORY -> SORRY_FOR_THE_WAIT ? PARSE_SARAH_GREET_WAIT / PARSE_SARAH_GREET_NO_WAIT
$ -> PARSE_SARAH_GREET_WAIT = MEMORY -> PLAYER_IN_TOWEL_WITH_SARAH ? PARSE_SARAH_GREET_WAIT_TOWEL / PARSE_SARAH_GREET_WAIT_NO_TOWEL
$ -> PARSE_SARAH_GREET_NO_WAIT = MEMORY -> PLAYER_IN_TOWEL_WITH_SARAH ? PARSE_SARAH_GREET_NO_WAIT_TOWEL / PARSE_SARAH_GREET_NO_WAIT_NO_TOWEL
$ -> PARSE_SARAH_GREET_NO_WAIT_NO_TOWEL = MEMORY -> PANCAKES ? TALK:SARAH_GREET_PANCAKES / TALK:SARAH_GREET
$ -> PARSE_SARAH_GREET_WAIT_NO_TOWEL = MEMORY -> PANCAKES ? TALK:SARAH_GREET_WAIT_PANCAKES / TALK:SARAH_GREET_WAIT
$ -> PARSE_SARAH_GREET_NO_WAIT_TOWEL = MEMORY -> PANCAKES ? TALK:SARAH_GREET_TOWEL_PANCAKES / TALK:SARAH_GREET_TOWEL
$ -> PARSE_SARAH_GREET_WAIT_TOWEL = MEMORY -> PANCAKES ? TALK:SARAH_GREET_WAIT_TOWEL_PANCAKES / TALK:SARAH_GREET_WAIT_TOWEL

TALKED = SARAH_GREET = GOTO -> WANNA_GO
TALKED = SARAH_GREET_WAIT = GOTO -> WANNA_GO
TALKED = SARAH_GREET_TOWEL = GOTO -> WANNA_GO
TALKED = SARAH_GREET_WAIT_TOWEL = GOTO -> WANNA_GO
TALKED = SARAH_GREET_PANCAKES = MEMORY -> PANCAKES_SMELL_ONLY ? SLOW:5-3, SLOW:8-2
TALKED = SARAH_GREET_WAIT_PANCAKES = MEMORY -> PANCAKES_SMELL_ONLY ? SLOW:5-3, SLOW:8-2
TALKED = SARAH_GREET_TOWEL_PANCAKES = MEMORY -> PANCAKES_SMELL_ONLY ? SLOW:5-3, SLOW:8-2
TALKED = SARAH_GREET_WAIT_TOWEL_PANCAKES = MEMORY -> PANCAKES_SMELL_ONLY ? SLOW:5-3, SLOW:8-2


//// HUG SARAH ////

! -> HUG_SARAH_CONDITIONNAL = MEMORY -> PLAYER_IN_TOWEL_WITH_SARAH ? REFUSING_HUG / ACCEPTING_HUG
$ -> REFUSING_HUG = GOTO -> FAST:5-2, SOUND:JUMP, AFFECTING:MOVE_PLAYER_TO_ENTRANCE, MEMORY:SARAH_REFUSED_HUG
GOAL -> 5-2 = GOTO -> FACING:RIGHT, WAITING_BEFORE_HUG_QUESTIONNING
$ -> WAITING_BEFORE_HUG_QUESTIONNING = WAITFOR -> TIMER:1 ? PARSE_SARAH_HUG_TOWEL_PANCAKES 
$ -> PARSE_SARAH_HUG_TOWEL_PANCAKES = MEMORY -> PANCAKES ? TALK:SARAH_HUG_TOWEL_PANCAKES / TALK:SARAH_HUG_TOWEL
TALED -> SARAH_HUG_TOWEL = GOTO -> WANNA_GO
TALED -> SARAH_HUG_TOWEL_PANCAKES = MEMORY -> PANCAKES_SMELL_ONLY ? SLOW:4-3, MOVE:8-2

$ -> ACCEPTING_HUG = GOTO -> AFFECTING:HIDE_PLAYER, HIDE_SARAH, CREATE_HUG, SOUND:JUMP, WAITING_BEFORE_HUG_TALKING
$ -> WAITING_BEFORE_HUG_TALKING = WAITFOR -> TIMER:1 ? TALK:SARAH_HUG
TALKED -> SARAH_HUG = WAITFOR -> TIMER:1 ? DELETE_HUG, AFFECTING:UNHIDE_PLAYER, UNHIDE_SARAH, WAITING_BEFORE_POST_HUG_TALKING
$ -> WAITING_BEFORE_POST_HUG_TALKING = WAITFOR -> TIMER:1 ? PARSE_SARAH_HUG_PANCAKES
$ -> PARSE_SARAH_HUG_PANCAKES = MEMORY -> PANCAKES ? TALK:SARAH_HUG_PANCAKES / TALK:SARAH_HUG_WANNA_GO
$ -> HIDE_SARAH = TP -> 2-15
$ -> UNHIDE_SARAH = TP -> 6-2
$ -> CREATE_HUG = CREATE_DECORATION -> 6-2-BACK:1,2,REBECCA_SARAH_HUG
$ -> DELETE_HUG = DELETE -> 6-2:1
$ -> PARSE_SARAH_HUG = MEMORY 
TALKED -> SARAH_HUG_WANNA_GO = GOTO -> WANNA_GO
TALKED = SARAH_HUG_PANCAKES = MEMORY -> PANCAKES_SMELL_ONLY ? SLOW:5-3, SLOW:8-2


//// SEARCH PANCAKES ////

GOAL -> 5-3 = SLOW -> 4-3
GOAL -> 4-3 = TALK -> SARAH_PANCAKES_SEARCH_KITCHEN
GOAL -> 8-2 = TALK -> SARAH_PANCAKES_SEARCH_TABLE
TALKED -> SARAH_PANCAKES_SEARCH_KITCHEN = CHOICE -> MAKE_SOME*PANCAKES_MAKE_SOME, WERE_TASTY*PANCAKES_WERE_TASTY
TALKED -> SARAH_PANCAKES_SEARCH_TABLE = CHOICE -> WE_SHARE*PANCAKES_SHARE, DOESNT_IT*PACAKES_SMELL_GOOD
! -> PANCAKES_WERE_TASTY = TALK -> SARAH_PANCAKES_WERE_TASTY
TALKED -> SARAH_PANCAKES_WERE_TASTY = GOTO -> WANNA_GO




! -> PANCAKES_MAKE_SOME = TALK -> SARAH_PANCAKES_WERE_TASTY
! -> PANCAKES_SHARE = TALK -> SARAH_PANCAKES_WERE_TASTY
! -> PACAKES_SMELL_GOOD = TALK -> SARAH_PANCAKES_WERE_TASTY

//// WANNA GO ////

$ -> WANNA_GO = CHOICE -> GREAT_IDEA*WANNA_GO_ACCEPT, NO_THANKS*WANNA_GO_REFUSE
! -> WANNA_GO_REFUSE = TALK -> SARAH_WANNA_GO_REFUSE
TALKED -> SARAH_WANNA_GO_REFUSE = CHOICE -> YOU_CONVINCED_ME*WANNA_GO_ACCEPT_BY_GREEDNESS, ANOTHER_TIME*WANNA_GO_REFUSE_FOR_REAL
! -> WANNA_GO_REFUSE_FOR_REAL = TALK -> SARAH_WANNA_GO_REFUSE_FOR_REAL
TALKED -> SARAH_WANNA_GO_REFUSE_FOR_REAL = WAITFOR -> TIMER:2 ? FACING:RIGHT, WAITING_BEFORE_SAD_GOODBYE
$ -> WAITING_BEFORE_SAD_GOODBYE = WAITFOR -> TIMER:2 ? TALK:SARAH_WANNA_GO_REFUSE_FOR_REAL_NEXT
TALKED -> SARAH_WANNA_GO_REFUSE_FOR_REAL_NEXT = GOTO -> AFFECTING:BLOCKING_PATH_ENTRANCE_FALSE, SLOW:8-0
GOAL -> 8-0 = GOTO -> AFFECTING:BLOCKING_PATH_ENTRANCE_TRUE, CUTSCENE:STOP

! -> WANNA_GO_ACCEPT_BY_GREEDNESS = TALK -> SARAH_WANNA_GO_ACCEPT_BY_GREEDNESS
! -> WANNA_GO_ACCEPT = TALK -> SARAH_WANNA_GO_ACCEPT
TALKED -> SARAH_WANNA_GO_ACCEPT_BY_GREEDNESS = GOTO -> DEED_GREEDNEES, CUTSCENE:STOP, WAITING_BEFORE_WATCHING_CAMILLE
$ -> DEED_GREEDNEES = DEED -> BAD, GREEDNEES
TALKED -> SARAH_WANNA_GO_ACCEPT = GOTO -> CUTSCENE:STOP, WAITING_BEFORE_WATCHING_CAMILLE
$ -> WAITING_BEFORE_WATCHING_CAMILLE = WAITFOR -> TIMER:6 ? SLOW:14-7





//// WATCH CAMILLE ////

GOAL -> 14-7 = GOTO -> NULL