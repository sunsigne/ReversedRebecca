TIME -> 0 = GOTO -> NAME:SARAH, PLAYER_AVOIDER_TYPE:CUTSCENE


//// STATE ////

TIME -> 100 = MEMORY -> VISITED ? NULL / TRY_ARRIVING


//// TRY ARRIVING ////

$ -> TRY_ARRIVING = CUTSCENE -> RUNNING ? WAITING_BEFORE_ARRIVING / PARSE_BED_ARRIVING
$ -> WAITING_BEFORE_ARRIVING = WAITFOR -> TIMER:1 ? TRY_ARRIVING
$ -> PARSE_BED_ARRIVING = CONDITION_PLAYER -> BED ? WAITING_BEFORE_ARRIVING / PARSE_BATH_ARRIVING
$ -> PARSE_BATH_ARRIVING = CONDITION_PLAYER -> BATH ? WAITING_BEFORE_ARRIVING / PARSE_RELAX_ARRIVING
$ -> PARSE_RELAX_ARRIVING = CONDITION_PLAYER -> RELAX ? WAITING_BEFORE_ARRIVING / PARSE_SIT_ARRIVING
$ -> PARSE_SIT_ARRIVING = CONDITION_PLAYER -> SIT ? WAITING_BEFORE_ARRIVING / PARSE_CHOOSING_ARRIVING
$ -> PARSE_CHOOSING_ARRIVING = CHOOSING -> TRUE ? WAITING_BEFORE_ARRIVING / AFFECTING:SARAH_ARRIVAL


//// DOOR KNOCKING ////

! -> SARAH_ARRIVAL = GOTO -> CUTSCENE:START, SOUND:DOOR_KNOCK, MUSIC:NULL, WAITING_BEFORE_REALISATION, AFFECTING:SOMEONE_JUST_KNOCKED, MEMORY:VISITED
$ -> WAITING_BEFORE_REALISATION = WAITFOR -> TIMER:2 ? PLAYER_REALIZE
$ -> PLAYER_REALIZE = GOTO -> FACING_PLAYER:DOWN, EXPRESSION_PLAYER:EXCLAMATION, CUTSCENE:STOP_WITH_DELAY, WAITING_BEFORE_KNOCKING_AGAIN
$ -> WAITING_BEFORE_KNOCKING_AGAIN = WAITFOR -> TIMER:4 ? SOUND:DOOR_KNOCK, WAITING_BEFORE_KNOCKING_LAST_TIME
$ -> WAITING_BEFORE_KNOCKING_LAST_TIME = WAITFOR -> TIMER:6 ? SOUND:DOOR_KNOCK, WAITING_BEFORE_TOO_LATE
$ -> WAITING_BEFORE_TOO_LATE = WAITFOR -> TIMER:7 ? AFFECTING:TOO_LATE_AT_DOOR, MEMORY:BUT_NOBODY_CAME


//// NOBODY CAME ////

$ -> WAITING_BEFORE_NOBODY_REALISATION = WAITFOR -> TIMER:2 ? EXPRESSION_PLAYER:SUSPENSION, WAITING_BEFORE_ABANDONMENT
$ -> WAITING_BEFORE_ABANDONMENT = WAITFOR -> TIMER:2 ? TALK:DOOR_TOO_LATE_OPEN
TALKED -> DOOR_TOO_LATE_OPEN = GOTO -> AFFECTING:BLOCKING_PATH_ENTRANCE_TRUE, CUTSCENE:STOP


//// ENTERING ////

! -> SARAH_STOP_KNOCKING = WAITFOR -> TIMER:30 ? MEMORY:SORRY_FOR_THE_WAIT
! -> SARAH_ENTER = MEMORY -> BUT_NOBODY_CAME ? WAITING_BEFORE_NOBODY_REALISATION / SLOW:6-2, MUSIC_WITHOUT_TRANSITION:SARAH_THEME
GOAL -> 6-2 = GOTO -> PARSE_PANCAKES_NOT_PROPOSED_ENTERING
$ -> PARSE_PANCAKES_NOT_PROPOSED_ENTERING = MEMORY -> PANCAKES_NOT_PROPOSED ? PANCAKES_NOT_PROPOSED / ENTERING_CASE
$ -> ENTERING_CASE = GOTO -> AFFECTING:BLOCKING_PATH_ENTRANCE_TRUE, AFFECTING:PLAYER_TOWEL_ANALYZER, MEMORY:SARAH_ENTERED, CHOOSE_GREETING
$ -> CHOOSE_GREETING = CHOICE -> GREET*GREET_SARAH, HUG*HUG_SARAH_CONDITIONNAL


//// GREET SARAH ////

! -> GREET_SARAH = MEMORY -> SORRY_FOR_THE_WAIT ? PARSE_SARAH_GREET_WAIT / PARSE_SARAH_GREET_NO_WAIT
$ -> PARSE_SARAH_GREET_WAIT = MEMORY -> PLAYER_IN_TOWEL_WITH_SARAH ? PARSE_SARAH_GREET_WAIT_TOWEL / PARSE_SARAH_GREET_WAIT_NO_TOWEL
$ -> PARSE_SARAH_GREET_NO_WAIT = MEMORY -> PLAYER_IN_TOWEL_WITH_SARAH ? PARSE_SARAH_GREET_NO_WAIT_TOWEL / PARSE_SARAH_GREET_NO_WAIT_NO_TOWEL
$ -> PARSE_SARAH_GREET_NO_WAIT_NO_TOWEL = MEMORY -> PANCAKES ? TALK:SARAH_GREET_PANCAKES / TALK:SARAH_GREET
$ -> PARSE_SARAH_GREET_WAIT_NO_TOWEL = MEMORY -> PANCAKES ? TALK:SARAH_GREET_WAIT_PANCAKES / TALK:SARAH_GREET_WAIT
$ -> PARSE_SARAH_GREET_NO_WAIT_TOWEL = MEMORY -> PANCAKES ? TALK:SARAH_GREET_TOWEL_PANCAKES / TALK:SARAH_GREET_TOWEL
$ -> PARSE_SARAH_GREET_WAIT_TOWEL = MEMORY -> PANCAKES ? TALK:SARAH_GREET_WAIT_TOWEL_PANCAKES / TALK:SARAH_GREET_WAIT_TOWEL

TALKED -> SARAH_GREET = GOTO -> WANNA_GO
TALKED -> SARAH_GREET_WAIT = GOTO -> WANNA_GO
TALKED -> SARAH_GREET_TOWEL = GOTO -> WANNA_GO
TALKED -> SARAH_GREET_WAIT_TOWEL = GOTO -> WANNA_GO
TALKED -> SARAH_GREET_PANCAKES = MEMORY -> PANCAKES_SMELL_ONLY ? WAITING_BEFORE_SEARCHING_PANCAKES_IN_KITCHEN / WAITING_BEFORE_SEARCHING_PANCAKES_ON_TABLE
TALKED -> SARAH_GREET_WAIT_PANCAKES = MEMORY -> PANCAKES_SMELL_ONLY ? WAITING_BEFORE_SEARCHING_PANCAKES_IN_KITCHEN / WAITING_BEFORE_SEARCHING_PANCAKES_ON_TABLE
TALKED -> SARAH_GREET_TOWEL_PANCAKES = MEMORY -> PANCAKES_SMELL_ONLY ? WAITING_BEFORE_SEARCHING_PANCAKES_IN_KITCHEN / WAITING_BEFORE_SEARCHING_PANCAKES_ON_TABLE
TALKED -> SARAH_GREET_WAIT_TOWEL_PANCAKES = MEMORY -> PANCAKES_SMELL_ONLY ? WAITING_BEFORE_SEARCHING_PANCAKES_IN_KITCHEN / WAITING_BEFORE_SEARCHING_PANCAKES_ON_TABLE



//// HUG SARAH ////

! -> HUG_SARAH_CONDITIONNAL = MEMORY -> PLAYER_IN_TOWEL_WITH_SARAH ? REFUSING_HUG / ACCEPTING_HUG
$ -> REFUSING_HUG = GOTO -> FAST:5-2, SOUND:JUMP, AFFECTING:MOVE_PLAYER_TO_ENTRANCE, MEMORY:SARAH_REFUSED_HUG
GOAL -> 5-2 = MEMORY -> PANCAKES_NOT_PROPOSED ? PANCAKES_NOT_PROPOSED / FACING:RIGHT, WAITING_BEFORE_HUG_QUESTIONNING
$ -> WAITING_BEFORE_HUG_QUESTIONNING = WAITFOR -> TIMER:1 ? PARSE_SARAH_HUG_TOWEL_PANCAKES 
$ -> PARSE_SARAH_HUG_TOWEL_PANCAKES = MEMORY -> PANCAKES ? TALK:SARAH_HUG_TOWEL_PANCAKES / TALK:SARAH_HUG_TOWEL
TALKED -> SARAH_HUG_TOWEL = GOTO -> WANNA_GO
TALKED -> SARAH_HUG_TOWEL_PANCAKES = MEMORY -> PANCAKES_SMELL_ONLY ? WAITING_BEFORE_SEARCHING_PANCAKES_IN_KITCHEN_POST_TOWEL_HUG / WAITING_BEFORE_SEARCHING_PANCAKES_ON_TABLE_POST_TOWEL_HUG

$ -> ACCEPTING_HUG = GOTO -> AFFECTING:HIDE_PLAYER, HIDE_SARAH, CREATE_HUG, SOUND:JUMP, WAITING_BEFORE_HUG_TALKING, MEMORY:LOVE_HUG
$ -> WAITING_BEFORE_HUG_TALKING = WAITFOR -> TIMER:1 ? TALK:SARAH_HUG
TALKED -> SARAH_HUG = WAITFOR -> TIMER:1 ? DELETE_HUG, AFFECTING:UNHIDE_PLAYER, UNHIDE_SARAH, WAITING_BEFORE_POST_HUG_TALKING
$ -> WAITING_BEFORE_POST_HUG_TALKING = WAITFOR -> TIMER:1 ? PARSE_SARAH_HUG_PANCAKES
$ -> PARSE_SARAH_HUG_PANCAKES = MEMORY -> PANCAKES ? TALK:SARAH_HUG_PANCAKES / TALK:SARAH_HUG_WANNA_GO
$ -> HIDE_SARAH = TP -> 0-16
$ -> UNHIDE_SARAH = TP -> 6-2
$ -> CREATE_HUG = CREATE_DECORATION -> 6-2-BACK:1,2,REBECCA_SARAH_HUG
$ -> DELETE_HUG = DELETE -> 6-2:1
$ -> PARSE_SARAH_HUG = MEMORY 
TALKED -> SARAH_HUG_WANNA_GO = GOTO -> WANNA_GO
TALKED -> SARAH_HUG_PANCAKES = MEMORY -> PANCAKES_SMELL_ONLY ? WAITING_BEFORE_SEARCHING_PANCAKES_IN_KITCHEN / WAITING_BEFORE_SEARCHING_PANCAKES_ON_TABLE


//// SEARCH PANCAKES ////

$ -> WAITING_BEFORE_SEARCHING_PANCAKES_IN_KITCHEN = WAITFOR -> TIMER:1 ? MOVE:5-3
$ -> WAITING_BEFORE_SEARCHING_PANCAKES_IN_KITCHEN_POST_TOWEL_HUG = WAITFOR -> TIMER:1 ? MOVE:3-3
$ -> WAITING_BEFORE_SEARCHING_PANCAKES_ON_TABLE = WAITFOR -> TIMER:1 ? MOVE:8-2
$ -> WAITING_BEFORE_SEARCHING_PANCAKES_ON_TABLE_POST_TOWEL_HUG = WAITFOR -> TIMER:1 ? MOVE:6-3
GOAL -> 5-3 = MEMORY -> PANCAKES_NOT_PROPOSED ? PANCAKES_NOT_PROPOSED / MOVE:3-3
GOAL -> 3-3 = WAITFOR -> TIMER:1 ? TALK:SARAH_PANCAKES_SEARCH_KITCHEN
GOAL -> 8-2 = MEMORY -> TRY_TO_SIT ? SIT / TALK:SARAH_PANCAKES_SEARCH_TABLE_DOWN
TALKED -> SARAH_PANCAKES_SEARCH_KITCHEN = CHOICE -> MAKE_SOME*PANCAKES_MAKE_SOME, WERE_TASTY*PANCAKES_WERE_TASTY
TALKED -> SARAH_PANCAKES_SEARCH_TABLE_DOWN = CHOICE -> WE_SHARE*PANCAKES_SHARE, YES_I_KNOW*PACAKES_SMELL_GOOD
TALKED -> SARAH_PANCAKES_SEARCH_TABLE_RIGHT = CHOICE -> WE_SHARE*PANCAKES_SHARE, YES_I_KNOW*PACAKES_SMELL_GOOD
! -> PANCAKES_WERE_TASTY = TALK -> SARAH_PANCAKES_NOT_PROPOSED
! -> PACAKES_SMELL_GOOD = TALK -> SARAH_PANCAKES_NOT_PROPOSED
TALKED -> SARAH_PANCAKES_NOT_PROPOSED = WAITFOR -> TIMER:1 ? MEMORY:PANCAKES_NOT_PROPOSED, PARSE_POS_AFTER_NOT_PROPOSED
$ -> PARSE_POS_AFTER_NOT_PROPOSED = FACING -> DOWN ? MOVE:6-2 / PARSE_SECOND_POSSIBILITY_NOT_PROPOSED 
$ -> PARSE_SECOND_POSSIBILITY_NOT_PROPOSED = FACING -> RIGHT ? PARSE_NOT_PROPOSED_TOWEL / MOVE:6-3
$ -> PARSE_NOT_PROPOSED_TOWEL = MEMORY -> SARAH_REFUSED_HUG ? MOVE:5-2 / MOVE:5-3
GOAL -> 6-3 = MEMORY -> PANCAKES_NOT_PROPOSED ? PANCAKES_NOT_PROPOSED / FACING_PLAYER:DOWN, TALK:SARAH_PANCAKES_SEARCH_TABLE_RIGHT
$ -> PANCAKES_NOT_PROPOSED = GOTO ->  TALK:SARAH_PANCAKES_NOT_PROPOSED_NEXT
TALKED -> SARAH_PANCAKES_NOT_PROPOSED_NEXT = GOTO -> FACING_PLAYER:SARAH, WANNA_GO

! -> PANCAKES_SHARE = GOTO -> GOOD_DEED:SHARE_PANCAKES, TALK:SARAH_PANCAKES_WE_SHARE
TALKED -> SARAH_PANCAKES_WE_SHARE = WAITFOR -> TIMER:1 ? PARSE_TABLE_POS, PLAYER_AVOIDER_TYPE:AROUND, AFFECTING:MOVE_PLAYER_TO_BUFFET
$ -> PARSE_TABLE_POS  = FACING -> DOWN ? SIT / MOVE:8-2, MEMORY:TRY_TO_SIT
$ -> SIT = GOTO -> PLAYER_AVOIDER_TYPE:CUTSCENE, AFFECTING:BLOCKING_PATH_CHAIR_TOWARD_DOWN_FALSE, TP:9-2, DISPLAY_SIT, FACING:DOWN, CONDITION:SIT, SOUND:JUMP
$ -> DISPLAY_SIT = DISPLAY -> 0, -1
! -> PLAYER_REACHED_BUFFET = WAITFOR -> TIMER:1 ? SOUND:PLATE, WAITING_BEFORE_PLAYER_BRINGING_PLATE
$ -> WAITING_BEFORE_PLAYER_BRINGING_PLATE = WAITFOR -> TIMER:1 ? AFFECTING:MOVE_PLAYER_TO_PANCAKES_TABLE
! -> PLAYER_REACHED_PANCAKES_TABLE = WAITFOR -> TIMER:1 ? PARSE_NEW_BATCH
$ -> DISPOSE_NEW_BATCH = GOTO -> AFFECTING:PANCAKES_CREATE_SARAH, WAITING_BEFORE_PLAYER_SITTING
$ -> WAITING_BEFORE_PLAYER_SITTING = WAITFOR -> TIMER:1 ? AFFECTING:PLAYER_SITTING_TO_PANCAKES, WAITING_BEFORE_TALK_PANCAKES_EATING_THANK
$ -> PLAYER_SITTING = STATE_PLAYER -> 7-3,2,-1,RIGHT,SIT, SOUND:JUMP
$ -> WAITING_BEFORE_TALK_PANCAKES_EATING_THANK = WAITFOR -> TIMER:1 ? TALK:SARAH_PANCAKES_EATING_THANK
TALKED -> SARAH_PANCAKES_EATING_THANK = WAITFOR -> TIMER:1 ? PARSE_NEW_BATCH_AGAIN

! -> PANCAKES_MAKE_SOME = GOTO -> GOOD_DEED:OFFER_PANCAKES, TALK:SARAH_PANCAKES_MAKE_MORE
TALKED -> SARAH_PANCAKES_MAKE_MORE = WAITFOR -> TIMER:1 ? PARSE_TABLE_POS, MEMORY:NEW_BATCH, AFFECTING:MOVE_PLAYER_TO_HOTPLATES
$ -> PARSE_NEW_BATCH = MEMORY -> NEW_BATCH ? DISPOSE_NEW_BATCH / SLIPT_PANCAKES
$ -> SLIPT_PANCAKES = GOTO -> AFFECTING:PANCAKES_SPLITAGE, WAITING_BEFORE_PLAYER_SITTING 
$ -> PARSE_NEW_BATCH_AGAIN = MEMORY -> NEW_BATCH ? AFFECTING:PANCAKES_SARAH_EATING / AFFECTING:PANCAKES_REBECCA_SARAH_EATING


//// WANNA GO ////

$ -> WANNA_GO = CHOICE -> GREAT_IDEA*WANNA_GO_ACCEPT, NO_THANKS*WANNA_GO_REFUSE
! -> WANNA_GO_REFUSE = WAITFOR -> TIMER:1 ? TALK:SARAH_WANNA_GO_REFUSE
TALKED -> SARAH_WANNA_GO_REFUSE = CHOICE -> I_ACCEPT*WANNA_GO_ACCEPT_BY_GREEDNESS, ANOTHER_TIME*WANNA_GO_REFUSE_FOR_REAL
! -> WANNA_GO_REFUSE_FOR_REAL = TALK -> SARAH_WANNA_GO_REFUSE_FOR_REAL
TALKED -> SARAH_WANNA_GO_REFUSE_FOR_REAL = WAITFOR -> TIMER:1 ? FACING:RIGHT, WAITING_BEFORE_SAD_GOODBYE
$ -> WAITING_BEFORE_SAD_GOODBYE = WAITFOR -> TIMER:2 ? TALK:SARAH_WANNA_GO_REFUSE_FOR_REAL_NEXT
TALKED -> SARAH_WANNA_GO_REFUSE_FOR_REAL_NEXT = GOTO -> AFFECTING:BLOCKING_PATH_ENTRANCE_FALSE, MEMORY:SARAH_WAIT_SPACE_TO_EXIT, AFFECTING:MOVE_PLAYER_TO_SIDE_STEP_ENTRANCE, PARSE_PANCAKES_NOT_PROPOSED_LEAVING
$ -> PARSE_PANCAKES_NOT_PROPOSED_LEAVING = MEMORY -> PANCAKES_NOT_PROPOSED ? PARSE_LOVE_HUG  / NULL
$ -> PARSE_LOVE_HUG = MEMORY -> LOVE_HUG ? NULL / BAD_DEED:FRIEND_RECEIVED_BADLY, MEMORY:BAD_FRIEND
! -> PLAYER_REACHED_SIDE_STEP_ENTRANCE = MEMORY -> SARAH_WAIT_SPACE_TO_EXIT ? WAITING_BEFORE_LEAVING / NULL
$ -> WAITING_BEFORE_LEAVING = WAITFOR -> TIMER:1 ? SLOW:8-0, MUSIC:REBECCAS_ROOM
GOAL -> 8-0 = GOTO -> AFFECTING:BLOCKING_PATH_ENTRANCE_TRUE, CUTSCENE:STOP

! -> WANNA_GO_ACCEPT_BY_GREEDNESS = TALK -> SARAH_WANNA_GO_ACCEPT_BY_GREEDNESS
! -> WANNA_GO_ACCEPT = TALK -> SARAH_WANNA_GO_ACCEPT
TALKED -> SARAH_WANNA_GO_ACCEPT_BY_GREEDNESS = GOTO -> CUTSCENE:STOP, START_IA
TALKED -> SARAH_WANNA_GO_ACCEPT = GOTO -> CUTSCENE:STOP, START_IA
TALKED -> SARAH_PANCAKES_EATING_SHARED_FINISHED = GOTO -> MEMORY:SAT, START_IA
TALKED -> SARAH_PANCAKES_EATING_FINISHED = GOTO -> MEMORY:SAT, START_IA
$ -> WAITING_BEFORE_STANDING_UP = WAITFOR -> TIMER:2 ? AFFECTING:BLOCKING_PATH_CHAIR_TOWARD_DOWN_TRUE, TP:8-2, DISPLAY_NORMAL, FACING:LEFT, CONDITION:STANDING, SOUND:JUMP, TA_READY, SLOW:14-7 
$ -> DISPLAY_NORMAL = DISPLAY -> 0, 0


//// START IA ////

$ -> START_IA = GOTO -> AFFECTING:SARAH_INTERACTION, MEMORY:SARAH_INTERACTION, PLAYER_AVOIDER_TYPE:AROUND, MUSIC:REBECCAS_ROOM, PARSE_SAT
$ -> PARSE_SAT = MEMORY -> SAT ? WAITING_BEFORE_STANDING_UP / WAITING_BEFORE_TA_READY
$ -> WAITING_BEFORE_TA_READY = WAITFOR -> TIMER:1 ? TA_READY, WAITING_BEFORE_WATCHING_CAMILLE
$ -> TA_READY = TRIPLE_ACTION -> I_AM_READY*I_AM_READY


//// WATCH CAMILLE ////

$ -> WAITING_BEFORE_WATCHING_CAMILLE = WAITFOR -> TIMER:1 ? SLOW:14-7
GOAL -> 14-7 = GOTO -> FACING:RIGHT