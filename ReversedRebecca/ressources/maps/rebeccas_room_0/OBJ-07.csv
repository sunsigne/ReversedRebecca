TIME -> 0 = GOTO -> HITBOX_INIT, TA_INIT


//// STATE ////

$ -> HITBOX_INIT = HITBOX -> 0, 3, 16, 16
$ -> TA_INIT = GOTO -> TA_FILL
! -> TA_NULL_BATH = TRIPLE_ACTION -> NULL


//// FILL BATH ////

$ -> TA_FILL = TRIPLE_ACTION -> FILL*FILL_BATH
$ -> FILL_BATH = GOTO -> AFFECTING:TA_NULL_BATH, CREATE_FILLING_BATH, SAVE_BATH_WATER, SOUND:BATH_FILL, WAITING_BEFORE_FILLED
$ -> CREATE_FILLING_BATH = CREATE_ANIMATION -> 1-8-BACK:1,2,BATH_FILLING,3,90,FALSE
$ -> WAITING_BEFORE_FILLED = WAITFOR -> TIMER:3 ? AFFECTING:TA_WASH, AFFECTING:HAS_EMPTIED_WASHLESS
$ -> SAVE_BATH_WATER = SAVE -> REGISTER, REBECCAS_ROOM*BATH_WATER


//// EMPTY BATH ////

$ -> EMPTY_BATH = GOTO -> AFFECTING:TA_NULL_BATH, CREATE_EMPTYING_BATH, UNSAVE_BATH_WATER, SOUND:BATH_EMPTY, DELETE_FILLING_BATH
$ -> CREATE_EMPTYING_BATH = CREATE_ANIMATION -> 1-8-BACK:1,2,BATH_EMPTYING,3,70,FALSE
$ -> DELETE_FILLING_BATH = DELETE -> 1-8:2
$ -> DELETE_EMPTYING_BATH = DELETE -> 1-8:1
$ -> UNSAVE_BATH_WATER = SAVE -> CANCEL_REGISTER, REBECCAS_ROOM*BATH_WATER


//// EMPTY WASHLESS ////

! -> HAS_EMPTIED_WASHLESS = MEMORY -> EMPTIED_WASHLESS ? ACTION_TWO:NULL / ACTION_TWO:EMPTY*EMPTY_BATH_WASHLESS
$ -> EMPTY_BATH_WASHLESS = GOTO -> EMPTY_BATH, NOTIFY_INCONSISTENCY, WAITING_BEFORE_WASHLESS_EMPTIED
$ -> NOTIFY_INCONSISTENCY = GOTO -> CUTSCENE:START, EXPRESSION_PLAYER:SUSPENSION, MEMORY:EMPTIED_WASHLESS
$ -> WAITING_BEFORE_WASHLESS_EMPTIED = WAITFOR -> TIMER:4 ? DELETE_EMPTYING_BATH, WAITING_BEFORE_INTERROGATION
$ -> WAITING_BEFORE_INTERROGATION = WAITFOR -> TIMER:2 ? TALK:EMPTY_WASHLESS
TALKED -> EMPTY_WASHLESS = GOTO -> CUTSCENE:STOP, TA_FILL


//// EMPTY AFTER WASH ////

$ -> EMPTY_BATH_AFTER_WASH = GOTO -> EMPTY_BATH, WAITING_BEFORE_EMPTIED
$ -> WAITING_BEFORE_EMPTIED = WAITFOR -> TIMER:4 ? DELETE_EMPTYING_BATH, CREATE_HAIR_HANDLER


//// WASH ////

! -> TA_WASH = TRIPLE_ACTION -> WASH*WASH
$ -> WASH = GOTO -> AFFECTING:TA_NULL_BATH, AFFECTING:BLOCKING_PATH_BATH_FALSE, PLAYER_GET_NAKED, PLAYER_ENTER_BATH, WAITING_BEFORE_CLEANED
! -> BLOCKING_PATH_BATH_FALSE = BLOCKING_PATH -> FALSE
$ -> PLAYER_GET_NAKED = GOTO -> PLAYER_DROP_GLASS, CREATE_CLOTHES_HANDLER, AFFECTING:NAME_PLAYER_REBECCA_TOWEL
$ -> PLAYER_ENTER_BATH = STATE_PLAYER -> 1-8,0,0,LEFT,BATH, SOUND:BATH_ENTER
$ -> WAITING_BEFORE_CLEANED = WAITFOR -> TIMER:4 ? CREATE_BATH_LEAVER_HANDLER
$ -> CREATE_BATH_LEAVER_HANDLER = GOTO -> CREATE_BATH_LEAVER, AFFECTING:BATH_LEAVER_INIT
$ -> CREATE_BATH_LEAVER = CREATE -> 0-8-BACK:8-255-255


//// DROP GLASS ////

$ -> PLAYER_DROP_GLASS = CONDITION_PLAYER -> GLASS ? CREATE_GLASS_HANDLER / NULL
$ -> CREATE_GLASS_HANDLER = GOTO -> AFFECTING:HAS_NO_WATER, AFFECTING:GLASS_ON_SINK, CREATE_GLASS, SAVE_GLASS_ON_SINK, SOUND:GLASS_TAKE
$ -> CREATE_GLASS = CREATE_DECORATION -> 3-7-BACK:1,1,GLASS_00
$ -> SAVE_GLASS_ON_SINK = SAVE -> REGISTER, REBECCAS_ROOM*GLASS_ON_SINK


//// CREATE CLOTHES ////

$ -> CREATE_CLOTHES_HANDLER = GOTO -> CREATE_CLOTHES, AFFECTING:CLOTHES_INIT
$ -> CREATE_CLOTHES = CREATE -> 2-8-BACK:9-255-255


//// EXIT WASH ////

! -> BLOCKING_PATH_BATH_TRUE = BLOCKING_PATH -> TRUE
! -> TA_EMPTY_BATH_AFTER_WASH = TRIPLE_ACTION -> EMPTY*EMPTY_BATH_AFTER_WASH


//// CLEAN HAIR ////

$ -> CREATE_HAIR_HANDLER = GOTO -> CREATE_HAIR, SAVE_BATH_HAIR, AFFECTING:TA_CLEAN_HAIR
! -> TA_CLEAN_HAIR = TRIPLE_ACTION -> CLEAN_HAIR*CLEAN_HAIR
$ -> CLEAN_HAIR = GOTO -> AFFECTING:TA_NULL_BATH, UNSAVE_BATH_HAIR, SOUND:CLOTHES, DELETE_HAIR
$ -> CREATE_HAIR = CREATE_DECORATION -> 1-8-BACK:1,2,BATH_HAIR
$ -> DELETE_HAIR = DELETE -> 1-8:1
$ -> SAVE_BATH_HAIR = SAVE -> REGISTER, REBECCAS_ROOM*BATH_HAIR
$ -> UNSAVE_BATH_HAIR = SAVE -> CANCEL_REGISTER, REBECCAS_ROOM*BATH_HAIR