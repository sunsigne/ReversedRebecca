TIME -> 0 = GOTO -> BLOCKING_PATH:FALSE, TA_INIT, CREATE_CHAIR


//// STATE ////

$ -> TA_INIT = TRIPLE_ACTION -> PLAY*TRY_PLAYING
$ -> CREATE_CHAIR = CREATE_DECORATION -> ONTHESPOT-FRONT:1,2,CHAIR_DOWN_00


//// TRY PLAYING ////

$ -> TRY_PLAYING = GOTO -> CUTSCENE:START, PLAYER_DROP_GLASS, UPDATE_CHAIR_SIT, AFFECTING:BLOCKING_PATH_DESK_FALSE, PLAYER_GOING_ON_SEAT, WAITING_BEFORE_GUILTYNESS
$ -> PLAYER_GOING_ON_SEAT = STATE_PLAYER -> 14-8,0,4,DOWN,SIT, SOUND:JUMP
$ -> WAITING_BEFORE_GUILTYNESS = WAITFOR -> TIMER:1 ? EXPRESSION:SUSPENSION, WAITING_BEFORE_TALKING
$ -> WAITING_BEFORE_TALKING = WAITFOR -> TIMER:2 ? GET_DIALOGUE
$ -> CANCEL_PLAYING = GOTO -> CUTSCENE:STOP, PLAYER_EXIT_SEAT, UPDATE_CHAIR
$ -> PLAYER_EXIT_SEAT = STATE_PLAYER -> 14-8,0,0,DOWN,GOOD, AFFECTING:BLOCKING_PATH_DESK_TRUE


//// UPDATE CHAIR ////

$ -> UPDATE_CHAIR_SIT = GOTO -> DELETE_ONTHESPOT:3, CREATE_CHAIR_SIT
$ -> CREATE_CHAIR_SIT = CREATE_DECORATION -> ONTHESPOT-BACK:1,2,CHAIR_DOWN_01
$ -> UPDATE_CHAIR = GOTO -> DELETE_ONTHESPOT:1, CREATE_CHAIR, AFFECTING:REFRESH_DESK, REFRESH_GLASS


//// DROP GLASS ////

$ -> PLAYER_DROP_GLASS = CONDITION_PLAYER -> GLASS ? CREATE_GLASS_HANDLER / NULL
$ -> CREATE_GLASS_HANDLER = GOTO -> NAME:GLASS, AFFECTING:HAS_NO_WATER, A2_TAKE_GLASS, CONDITION_PLAYER:GOOD, CREATE_GLASS, SAVE_GLASS_ON_DESK, SOUND:GLASS_TAKE
$ -> CREATE_GLASS = CREATE_DECORATION -> 13-9-FRONT:1,1,GLASS_02
$ -> SAVE_GLASS_ON_DESK = SAVE -> REGISTER, REBECCAS_ROOM*GLASS_ON_DESK
$ -> REFRESH_GLASS = NAME -> GLASS ? CREATE_GLASS / NULL


//// TAKE GLASS ////

$ -> A2_TAKE_GLASS = ACTION -> 2,TAKE_GLASS*TAKE_GLASS
$ -> TAKE_GLASS = GOTO -> NAME:CHAIR, AFFECTING:HAS_WATER, DELETE_GLASS, CONDITION_PLAYER:GLASS, UNSAVE_GLASS_ON_DESK, SOUND:GLASS_TAKE
$ -> DELETE_GLASS = DELETE -> 13-9:10
$ -> UNSAVE_GLASS_ON_DESK = SAVE -> CANCEL_REGISTER, REBECCAS_ROOM*GLASS_ON_DESK


//// DIFFERENT DIALOGUES ////

$ -> GET_DIALOGUE = MEMORY -> FIRST_TIME_PLAYING ? GET_SECOND_DIALOGUE / FIRST_DIALOGUE
$ -> FIRST_DIALOGUE = GOTO -> TALK:CANT_PLAY, ACTION_ONE:PLAY_ANYWAY*TRY_PLAYING
TALKED -> CANT_PLAY = GOTO -> MEMORY:FIRST_TIME_PLAYING, CANCEL_PLAYING, STOP_JOKING_IF_TOO_FAR

$ -> GET_SECOND_DIALOGUE = MEMORY -> SECOND_TIME_PLAYING ? GET_THIRD_DIALOGUE / SECOND_DIALOGUE
$ -> SECOND_DIALOGUE = GOTO -> TALK:CANT_PLAY_SECOND, ACTION_ONE:JUST_ONE_GAME*TRY_PLAYING
TALKED -> CANT_PLAY_SECOND = GOTO -> MEMORY:SECOND_TIME_PLAYING, CANCEL_PLAYING, STOP_JOKING_IF_TOO_FAR

$ -> GET_THIRD_DIALOGUE = MEMORY -> THIRD_TIME_PLAYING ? GET_FOURTH_DIALOGUE / THIRD_DIALOGUE
$ -> THIRD_DIALOGUE = GOTO -> TALK:CANT_PLAY_THIRD, ACTION_ONE:I_AM_WEAK*TRY_PLAYING
TALKED -> CANT_PLAY_THIRD = GOTO ->  MEMORY:THIRD_TIME_PLAYING, CANCEL_PLAYING, STOP_JOKING_IF_TOO_FAR

$ -> GET_FOURTH_DIALOGUE = MEMORY -> FOURTH_TIME_PLAYING ? NULL / FOURTH_DIALOGUE
$ -> FOURTH_DIALOGUE = GOTO -> TALK:CANT_PLAY_FOURTH
TALKED -> CANT_PLAY_FOURTH = GOTO ->  MEMORY:FOURTH_TIME_PLAYING, CANCEL_PLAYING

$ -> STOP_JOKING_IF_TOO_FAR = WAITFOR -> PLAYER_FUTHER_THAN:3 ? ACTION_ONE:NULL