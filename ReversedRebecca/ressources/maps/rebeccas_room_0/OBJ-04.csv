TIME -> 0 = GOTO -> NAME:BATH, TA_FILL, CREATE_TOWEL_CONDITIONAL
! -> TA_NULL_BATH = TRIPLE_ACTION -> NULL


//// FILL BATH ////

$ -> TA_FILL = TRIPLE_ACTION -> FILL*FILL_BATH
$ -> FILL_BATH = GOTO -> AFFECTING:TA_NULL_BATH, CREATE_FILLING_BATH, SOUND:BATH_FILL, WAITING_BEFORE_FILLED
$ -> CREATE_FILLING_BATH = CREATE -> 1-7:250-0-255
$ -> WAITING_BEFORE_FILLED = WAITFOR -> TIMER:3 ? TA_RAW_WASH
$ -> TA_RAW_WASH = MEMORY -> EMPTY_WASHLESS ? AFFECTING:TA_WASH / AFFECTING:TA_WASH_EMPTY_WASHLESS


//// RAW EMPTY ////

$ -> RAW_EMPTY_BATH = GOTO -> AFFECTING:TA_NULL_BATH, CREATE_EMPTYING_BATH, SOUND:BATH_EMPTY, DELETE_FILLING_BATH
$ -> CREATE_EMPTYING_BATH = CREATE -> 1-7:250-0-254
$ -> DELETE_FILLING_BATH = DELETE -> 1-7:2
$ -> DELETE_EMPTYING_BATH = DELETE -> 1-7:1


//// EMPTY WASHLESS ////

! -> TA_WASH_EMPTY_WASHLESS = TRIPLE_ACTION -> WASH*WASH, EMPTY*EMPTY_BATH_WASHLESS
$ -> EMPTY_BATH_WASHLESS = GOTO -> RAW_EMPTY_BATH, NOTIFY_INCONSISTENCY, WAITING_BEFORE_WASHLESS_EMPTIED
$ -> NOTIFY_INCONSISTENCY = GOTO -> CUTSCENE:START, EXPRESSION_PLAYER:SUSPENSION, MEMORY:EMPTY_WASHLESS
$ -> WAITING_BEFORE_WASHLESS_EMPTIED = WAITFOR -> TIMER:4 ? DELETE_EMPTYING_BATH, WAITING_BEFORE_INTERROGATION
$ -> WAITING_BEFORE_INTERROGATION = WAITFOR -> TIMER:2 ? TALK:EMPTY_WASHLESS
TALKED -> EMPTY_WASHLESS = GOTO -> CUTSCENE:STOP, TA_FILL


//// WASH ////

! -> TA_WASH = TRIPLE_ACTION -> WASH*WASH
$ -> WASH = GOTO -> AFFECTING:TA_NULL_BATH, PLAYER_GET_NAKED, PLAYER_ENTER_BATH, SOUND:BATH_ENTER, WAITING_BEFORE_CLEANED
$ -> PLAYER_GET_NAKED = GOTO -> PLAYER_DROP_CONDITIONAL_GLASS, CREATE_CLOTHES_HANDLER, AFFECTING:PLAYER_CLOTHLESS
$ -> PLAYER_ENTER_BATH = GOTO -> AFFECTING:BLOCKING_PATH_BATH_FALSE, AFFECTING:TP_PLAYER_INTO_BATH, FACING_PLAYER:LEFT, CONDITION_PLAYER:BATH
! -> BLOCKING_PATH_BATH_FALSE = BLOCKING_PATH -> FALSE
$ -> WAITING_BEFORE_CLEANED = WAITFOR -> TIMER:4 ? CREATE_BATH_EXIT_HANDLER
$ -> CREATE_BATH_EXIT_HANDLER = GOTO -> CREATE_BATH_EXIT, AFFECTING:BATH_EXIT_INIT
$ -> CREATE_BATH_EXIT = CREATE -> 0-7:5-255-255


//// CONDITIONAL GLASS ////

$ -> PLAYER_DROP_CONDITIONAL_GLASS = CONDITION_PLAYER -> GLASS ? CREATE_GLASS_HANDLER / NULL
$ -> CREATE_GLASS_HANDLER = GOTO -> AFFECTING:HAS_NO_WATER, CREATE_GLASS, MEMORY:DROP_GLASS
$ -> CREATE_GLASS = CREATE -> 3-7:251-0-254


//// CREATE CLOTHES ////

$ -> CREATE_CLOTHES_HANDLER = GOTO -> CREATE_CLOTHES, AFFECTING:CLOTHES_INIT
$ -> CREATE_CLOTHES = CREATE -> 2-8:9-255-255


//// EXIT WASH ////

! -> BLOCKING_PATH_BATH_TRUE = BLOCKING_PATH -> TRUE
! -> TA_EMPTY_BATH_AFTER_WASH = TRIPLE_ACTION -> EMPTY*EMPTY_BATH_AFTER_WASH


//// EMPTY BATH ////

$ -> EMPTY_BATH_AFTER_WASH = GOTO -> RAW_EMPTY_BATH, WAITING_BEFORE_EMPTIED
$ -> WAITING_BEFORE_EMPTIED = WAITFOR -> TIMER:4 ? DELETE_EMPTYING_BATH, HAIR_CREATION


//// CLEAN HAIR ////

$ -> HAIR_CREATION = GOTO -> CREATE_HAIR, AFFECTING:TA_CLEAN_HAIR
! -> TA_CLEAN_HAIR = TRIPLE_ACTION -> CLEAN_HAIR*CLEAN_HAIR
$ -> CLEAN_HAIR = GOTO -> AFFECTING:TA_NULL_BATH, SOUND:CLOTHES, DELETE_HAIR
$ -> CREATE_HAIR = CREATE -> 1-7:250-0-253
$ -> DELETE_HAIR = DELETE -> 1-7:1