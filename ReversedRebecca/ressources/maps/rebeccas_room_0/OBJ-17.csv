TIME -> 0 = GOTO -> HITBOX_INIT, TA_INIT, CREATE_DESK


//// STATE ////

$ -> HITBOX_INIT = HITBOX -> -4, -3, 20, 19
$ -> TA_INIT = TRIPLE_ACTION -> PLAY*TRY_PLAYING
$ -> CREATE_DESK = CREATE_DECORATION -> 13-8-FRONT:3,2,DESK_UP


//// TRY PLAYING ////

$ -> TRY_PLAYING = GOTO -> CUTSCENE:START, PLAYER_DROP_GLASS, AFFECTING:UPDATE_CHAIR_SIT, BLOCKING_PATH:FALSE, PLAYER_GOING_ON_SEAT, WAITING_BEFORE_GUILTYNESS
$ -> PLAYER_GOING_ON_SEAT = STATE_PLAYER -> 14-8,0,4,DOWN,SIT, SOUND:JUMP
$ -> WAITING_BEFORE_GUILTYNESS = WAITFOR -> TIMER:1 ? AFFECTING:EXPRESSION_PLAYER_SUSPENSION, WAITING_BEFORE_TALKING
$ -> WAITING_BEFORE_TALKING = WAITFOR -> TIMER:2 ? GET_DIALOGUE
$ -> CANCEL_PLAYING = GOTO -> CUTSCENE:STOP, PLAYER_EXIT_SEAT, AFFECTING:UPDATE_CHAIR
$ -> PLAYER_EXIT_SEAT = STATE_PLAYER -> 14-8,0,0,DOWN,GOOD, BLOCKING_PATH:TRUE


//// REFRESH DESK ////

! -> REFRESH_DESK = GOTO -> DELETE_DESK, CREATE_DESK, REFRESH_GLASS
$ -> DELETE_DESK = DELETE -> 13-8:1


//// DROP GLASS ////

$ -> PLAYER_DROP_GLASS = CONDITION_PLAYER -> GLASS ? CREATE_GLASS_HANDLER / NULL
$ -> CREATE_GLASS_HANDLER = GOTO -> NAME:GLASS, AFFECTING:HAS_NO_WATER, A2_TAKE_GLASS, CONDITION_PLAYER:GOOD, CREATE_GLASS, SAVE_GLASS_ON_DESK, SOUND:GLASS
$ -> CREATE_GLASS = CREATE_DECORATION -> 13-9-FRONT:1,1,GLASS_02
$ -> SAVE_GLASS_ON_DESK = SAVE -> REGISTER, REBECCAS_ROOM*GLASS_ON_DESK
$ -> REFRESH_GLASS = NAME -> GLASS ? CREATE_GLASS / NULL


//// TAKE GLASS ////

! -> HAS_WATER = ACTION_TWO -> NULL
! -> HAS_NO_WATER = NAME -> GLASS ? A2_TAKE_GLASS / NULL
$ -> A2_TAKE_GLASS = ACTION -> 2,TAKE_GLASS*TAKE_GLASS
$ -> TAKE_GLASS = GOTO -> NAME:CHAIR, AFFECTING:HAS_WATER, DELETE_GLASS, CONDITION_PLAYER:GLASS, UNSAVE_GLASS_ON_DESK, SOUND:GLASS
$ -> DELETE_GLASS = DELETE -> 13-9:10
$ -> UNSAVE_GLASS_ON_DESK = SAVE -> CANCEL_REGISTER, REBECCAS_ROOM*GLASS_ON_DESK


//// DIFFERENT DIALOGUES ////

$ -> GET_DIALOGUE = MEMORY -> FIRST_TIME_PLAYING ? GET_SECOND_DIALOGUE / FIRST_DIALOGUE
$ -> FIRST_DIALOGUE = GOTO -> TALK:CANT_PLAY, ACTION_ONE:PLAY_ANYWAY*TRY_PLAYING
TALKED -> CANT_PLAY = GOTO -> MEMORY:FIRST_TIME_PLAYING, CANCEL_PLAYING, STOP_JOKING_IF_TOO_FAR

$ -> GET_SECOND_DIALOGUE = MEMORY -> SECOND_TIME_PLAYING ? GET_THIRD_DIALOGUE / SECOND_DIALOGUE
$ -> SECOND_DIALOGUE = GOTO -> TALK:CANT_PLAY_SECOND, ACTION_ONE:JUST_ONE_GAME*TRY_PLAYING
TALKED -> CANT_PLAY_SECOND = GOTO -> MEMORY:SECOND_TIME_PLAYING, CANCEL_PLAYING, STOP_JOKING_IF_TOO_FAR

$ -> GET_THIRD_DIALOGUE = MEMORY -> THIRD_TIME_PLAYING ? GET_FOURTH_DIALOGUE / THIRD_DIALOGUE
$ -> THIRD_DIALOGUE = GOTO -> TALK:CANT_PLAY_THIRD, ACTION_ONE:I_AM_WEAK*TRY_PLAYING
TALKED -> CANT_PLAY_THIRD = GOTO ->  MEMORY:THIRD_TIME_PLAYING, CANCEL_PLAYING, STOP_JOKING_IF_TOO_FAR

$ -> GET_FOURTH_DIALOGUE = MEMORY -> FOURTH_TIME_PLAYING ? NULL / FOURTH_DIALOGUE
$ -> FOURTH_DIALOGUE = GOTO -> TALK:CANT_PLAY_FOURTH
TALKED -> CANT_PLAY_FOURTH = GOTO ->  MEMORY:FOURTH_TIME_PLAYING, CANCEL_PLAYING

$ -> STOP_JOKING_IF_TOO_FAR = WAITFOR -> PLAYER_FUTHER_THAN:3 ? ACTION_ONE:NULL